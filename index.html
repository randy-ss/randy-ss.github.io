<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>äº§å“å¼‚å¸¸åˆ†ææŠ¥å‘Š - å¸¦ä¿å­˜åŠŸèƒ½ï¼ˆå®Œæ•´ç‰ˆï¼‰</title>
    <style>
        /* æ‰“å°ä¼˜åŒ– */
        @page {
            size: A4;
            margin: 1.5cm;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: "Microsoft YaHei", "SimSun", sans-serif;
        }
        
        body {
            color: #000;
            line-height: 1.5;
            font-size: 12pt;
            background: #fff;
            padding: 0;
        }
        
        .container {
            max-width: 21cm;
            margin: 0 auto;
            padding: 1.5cm;
            background: white;
            position: relative;
        }
        
        header {
            text-align: center;
            margin-bottom: 1.5cm;
            border-bottom: 2pt solid #1a5276;
            padding-bottom: 0.5cm;
        }
        
        h1 {
            font-size: 18pt;
            margin-bottom: 0.3cm;
            font-weight: bold;
            color: #1a5276;
        }
        
        .report-info {
            display: flex;
            justify-content: space-between;
            margin-top: 0.5cm;
            font-size: 10pt;
        }
        
        .section {
            margin-bottom: 0.8cm;
            page-break-inside: avoid;
        }
        
        .section-title {
            font-size: 14pt;
            font-weight: bold;
            margin-bottom: 0.4cm;
            padding-bottom: 0.2cm;
            border-bottom: 1pt solid #1a5276;
            color: #1a5276;
        }
        
        .subsection {
            margin-bottom: 0.5cm;
            padding: 0.3cm;
            border: 0.5pt solid #eaeaea;
            border-radius: 4pt;
        }
        
        .subsection-title {
            font-size: 12pt;
            font-weight: bold;
            margin-bottom: 0.2cm;
            color: #2874a6;
        }
        
        .form-group {
            margin-bottom: 0.3cm;
        }
        
        label {
            display: inline-block;
            margin-bottom: 0.1cm;
            font-weight: bold;
            min-width: 3cm;
        }
        
        .form-line {
            display: flex;
            align-items: flex-start;
            margin-bottom: 0.2cm;
        }
        
        input, select, textarea {
            border: none;
            border-bottom: 0.5pt solid #666;
            font-size: 11pt;
            padding: 0.1cm 0;
            background: transparent;
            flex: 1;
        }
        
        input:focus, select:focus, textarea:focus {
            outline: none;
            border-bottom: 0.5pt solid #1a5276;
        }
        
        textarea {
            min-height: 1.5cm;
            resize: vertical;
            width: 100%;
        }
        
        .full-width {
            width: 100%;
        }
        
        .short-input {
            width: 60%;
        }
        
        .two-column {
            display: flex;
            justify-content: space-between;
            flex-wrap: wrap;
        }
        
        .column {
            width: 48%;
        }
        
        .three-column {
            display: flex;
            justify-content: space-between;
            flex-wrap: wrap;
        }
        
        .col-3 {
            width: 30%;
        }
        
        .btn-group {
            display: flex;
            justify-content: center;
            margin-top: 1cm;
            flex-wrap: wrap;
            gap: 0.5cm;
        }
        
        button {
            padding: 0.3cm 0.8cm;
            margin: 0 0.2cm;
            border: 1pt solid #1a5276;
            background: #fff;
            cursor: pointer;
            font-size: 11pt;
            color: #1a5276;
            border-radius: 3pt;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.2cm;
        }
        
        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
        
        .btn-primary {
            background: #d6eaf8;
        }
        
        .btn-success {
            background: #d5f4e6;
            border-color: #27ae60;
            color: #27ae60;
        }
        
        .btn-excel {
            background: #e8f6f3;
            border-color: #1abc9c;
            color: #1abc9c;
        }
        
        .btn-save {
            background: #fef9e7;
            border-color: #f39c12;
            color: #f39c12;
        }
        
        .btn-small {
            padding: 0.1cm 0.3cm;
            font-size: 9pt;
            margin: 0.1cm;
        }
        
        .analysis-method {
            margin-bottom: 0.4cm;
        }
        
        .method-title {
            font-weight: bold;
            margin-bottom: 0.2cm;
            font-size: 11pt;
            color: #2874a6;
        }
        
        .attachment-note {
            font-style: italic;
            margin-top: 0.3cm;
            font-size: 10pt;
            color: #666;
        }
        
        .main-cause {
            background-color: #f9f9f9;
            padding: 0.3cm;
            border-left: 3pt solid #3498db;
            margin: 0.3cm 0;
        }
        
        .image-placeholder {
            width: 100%;
            height: 6cm;
            border: 1pt dashed #666;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-top: 0.2cm;
            background-color: #f9f9f9;
        }
        
        .image-upload-btn {
            margin-top: 0.3cm;
            padding: 0.2cm 0.5cm;
            background: transparent;
            border: none;
            cursor: pointer;
            font-size: 10pt;
            text-align: center;
            width: 100%;
            color: #1a5276;
        }
        
        .image-grid {
            display: flex;
            flex-wrap: wrap;
            gap: 0.3cm;
            margin-top: 0.2cm;
        }
        
        .image-item {
            width: calc(20% - 0.24cm);
            height: 4cm;
            border: 1pt dashed #666;
            display: flex;
            align-items: center;
            justify-content: center;
            background-color: #f9f9f9;
            position: relative;
        }
        
        .image-item img {
            max-width: 100%;
            max-height: 100%;
        }
        
        .image-remove {
            position: absolute;
            top: 0;
            right: 0;
            background: rgba(255,0,0,0.7);
            color: white;
            border: none;
            cursor: pointer;
            font-size: 8pt;
            padding: 0.1cm;
        }
        
        .priority-high {
            color: #e74c3c;
            font-weight: bold;
        }
        
        .priority-medium {
            color: #f39c12;
            font-weight: bold;
        }
        
        .priority-low {
            color: #27ae60;
            font-weight: bold;
        }
        
        .guidance-text {
            font-size: 9pt;
            color: #7f8c8d;
            font-style: italic;
            margin-top: 0.1cm;
        }
        
        .standard-text {
            font-size: 9pt;
            color: #2c3e50;
            margin-top: 0.1cm;
            font-weight: bold;
        }
        
        .improvement-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 0.3cm;
        }
        
        .improvement-table th, .improvement-table td {
            border: 0.5pt solid #ddd;
            padding: 0.2cm;
            text-align: left;
            font-size: 10pt;
        }
        
        .improvement-table th {
            background-color: #f2f2f2;
            font-weight: bold;
        }
        
        .add-row-btn {
            margin-top: 0.2cm;
            padding: 0.2cm 0.5cm;
            background: #e8f4fc;
            border: 1pt solid #1a5276;
            cursor: pointer;
            font-size: 9pt;
            color: #1a5276;
        }
        
        .remove-row-btn {
            background: #f8d7da;
            border: 1pt solid #dc3545;
            color: #dc3545;
            cursor: pointer;
            font-size: 8pt;
            padding: 0.1cm 0.2cm;
        }
        
        .time-limit {
            color: #e74c3c;
            font-weight: bold;
        }
        
        /* æ–°å¢: ä¿å­˜åŠŸèƒ½ç›¸å…³æ ·å¼ */
        .save-indicator {
            position: fixed;
            top: 1cm;
            right: 1cm;
            background: #2ecc71;
            color: white;
            padding: 0.5cm 1cm;
            border-radius: 4pt;
            box-shadow: 0 2px 10px rgba(0,0,0,0.2);
            z-index: 1000;
            display: none;
            align-items: center;
            gap: 0.5cm;
        }
        
        .save-error {
            background: #e74c3c;
        }
        
        .save-warning {
            background: #f39c12;
        }
        
        .auto-save-indicator {
            position: fixed;
            bottom: 1cm;
            right: 1cm;
            background: #3498db;
            color: white;
            padding: 0.3cm 0.8cm;
            border-radius: 4pt;
            font-size: 10pt;
            display: none;
            z-index: 1000;
        }
        
        .save-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.5);
            z-index: 2000;
            align-items: center;
            justify-content: center;
        }
        
        .save-modal-content {
            background: white;
            padding: 1.5cm;
            border-radius: 8pt;
            width: 80%;
            max-width: 30cm;
            max-height: 80%;
            overflow-y: auto;
            box-shadow: 0 5px 15px rgba(0,0,0,0.3);
        }
        
        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1cm;
            border-bottom: 1pt solid #ddd;
            padding-bottom: 0.5cm;
        }
        
        .modal-title {
            font-size: 16pt;
            color: #1a5276;
            font-weight: bold;
        }
        
        .close-modal {
            background: none;
            border: none;
            font-size: 16pt;
            cursor: pointer;
            color: #666;
        }
        
        .save-options {
            margin-bottom: 1cm;
        }
        
        .option-group {
            margin-bottom: 0.5cm;
        }
        
        .option-group label {
            display: block;
            margin-bottom: 0.3cm;
            font-weight: bold;
        }
        
        .radio-group, .checkbox-group {
            display: flex;
            flex-wrap: wrap;
            gap: 0.5cm;
        }
        
        .radio-item, .checkbox-item {
            display: flex;
            align-items: center;
            margin-bottom: 0.3cm;
        }
        
        .radio-item input, .checkbox-item input {
            margin-right: 0.3cm;
            width: auto;
        }
        
        .radio-item label, .checkbox-item label {
            margin-bottom: 0;
            min-width: auto;
        }
        
        .save-description {
            font-size: 10pt;
            color: #666;
            margin-top: 0.2cm;
        }
        
        .progress-bar {
            width: 100%;
            height: 0.5cm;
            background-color: #f0f0f0;
            border-radius: 0.25cm;
            overflow: hidden;
            margin: 0.5cm 0;
            display: none;
        }
        
        .progress-fill {
            height: 100%;
            background-color: #1abc9c;
            width: 0%;
            transition: width 0.3s;
        }
        
        .progress-text {
            text-align: center;
            font-size: 10pt;
            color: #666;
            margin-bottom: 0.5cm;
            display: none;
        }
        
        .save-status {
            margin-top: 1cm;
            padding: 0.5cm;
            border-radius: 4pt;
            display: none;
        }
        
        .save-success {
            background-color: #d5f4e6;
            border: 1pt solid #27ae60;
            color: #27ae60;
        }
        
        .save-error {
            background-color: #f8d7da;
            border: 1pt solid #e74c3c;
            color: #e74c3c;
        }
        
        .load-modal-content {
            max-width: 40cm;
        }
        
        .saved-reports-list {
            max-height: 30cm;
            overflow-y: auto;
            margin: 1cm 0;
            border: 1pt solid #ddd;
            border-radius: 4pt;
        }
        
        .report-item {
            padding: 0.5cm;
            border-bottom: 1pt solid #eee;
            cursor: pointer;
            transition: background 0.3s;
        }
        
        .report-item:hover {
            background: #f5f5f5;
        }
        
        .report-item.selected {
            background: #e8f4fc;
            border-left: 3pt solid #3498db;
        }
        
        .report-title {
            font-weight: bold;
            margin-bottom: 0.2cm;
            color: #2c3e50;
        }
        
        .report-meta {
            font-size: 9pt;
            color: #7f8c8d;
            display: flex;
            justify-content: space-between;
        }
        
        .report-actions {
            display: flex;
            gap: 0.3cm;
            margin-top: 0.3cm;
        }
        
        .empty-list {
            text-align: center;
            padding: 2cm;
            color: #7f8c8d;
            font-style: italic;
        }
        
        .save-formats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(5cm, 1fr));
            gap: 0.5cm;
            margin: 1cm 0;
        }
        
        .format-option {
            border: 1pt solid #ddd;
            border-radius: 4pt;
            padding: 0.8cm;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .format-option:hover {
            border-color: #3498db;
            background: #f8f9fa;
        }
        
        .format-option.selected {
            border-color: #3498db;
            background: #e8f4fc;
        }
        
        .format-icon {
            font-size: 24pt;
            margin-bottom: 0.3cm;
            color: #3498db;
        }
        
        .format-name {
            font-weight: bold;
            margin-bottom: 0.2cm;
        }
        
        .format-desc {
            font-size: 9pt;
            color: #666;
        }
        
        /* é¡¶éƒ¨å·¥å…·æ  */
        .top-toolbar {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            background: white;
            padding: 0.5cm 1cm;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            z-index: 1000;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .toolbar-left, .toolbar-right {
            display: flex;
            align-items: center;
            gap: 0.5cm;
        }
        
        .report-status {
            font-size: 10pt;
            color: #666;
        }
        
        .last-saved {
            font-size: 9pt;
            color: #95a5a6;
        }
        
        .unsaved-changes {
            color: #f39c12;
            font-weight: bold;
        }
        
        /* æ‰“å°æ—¶éšè—æŒ‰é’® */
        @media print {
            .btn-group, .image-upload-btn, .image-remove, .add-row-btn, .remove-row-btn,
            .save-modal, .progress-bar, .progress-text, .save-status,
            .save-indicator, .auto-save-indicator, .top-toolbar {
                display: none;
            }
            
            .container {
                padding: 0;
                margin-top: 2cm;
            }
            
            .image-placeholder, .image-item {
                border: 1pt solid #000;
            }
        }
        
        /* å±å¹•æ˜¾ç¤ºæ ·å¼ */
        @media screen {
            body {
                background: #f5f5f5;
                padding: 5cm 1cm 1cm;
            }
            
            .container {
                box-shadow: 0 0 10px rgba(0,0,0,0.1);
                margin-top: 1cm;
            }
        }
    </style>
    <!-- å¼•å…¥xlsxåº“ç”¨äºç”ŸæˆExcelæ–‡ä»¶ -->
    <script src="https://unpkg.com/xlsx@0.18.5/dist/xlsx.full.min.js"></script>
    <!-- å¼•å…¥FileSaverç”¨äºæ–‡ä»¶ä¿å­˜ -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/FileSaver.js/2.0.5/FileSaver.min.js"></script>
</head>
<body>
    <!-- é¡¶éƒ¨å·¥å…·æ  -->
    <div class="top-toolbar">
        <div class="toolbar-left">
            <button class="btn-save" onclick="openSaveModal()">
                <span>ğŸ’¾</span> ä¿å­˜æŠ¥å‘Š
            </button>
            <button onclick="openLoadModal()">
                <span>ğŸ“‚</span> åŠ è½½æŠ¥å‘Š
            </button>
            <div class="report-status">
                çŠ¶æ€: <span id="reportStatus">ç¼–è¾‘ä¸­</span>
            </div>
        </div>
        <div class="toolbar-right">
            <div class="last-saved" id="lastSaved">
                ä¸Šæ¬¡ä¿å­˜: ä»æœªä¿å­˜
            </div>
        </div>
    </div>
    
    <!-- ä¿å­˜æç¤º -->
    <div class="save-indicator" id="saveIndicator">
        <span>âœ“</span> æŠ¥å‘Šå·²ä¿å­˜
    </div>
    
    <!-- è‡ªåŠ¨ä¿å­˜æç¤º -->
    <div class="auto-save-indicator" id="autoSaveIndicator">
        è‡ªåŠ¨ä¿å­˜ä¸­...
    </div>

    <div class="container">
        <header>
            <h1>äº§å“å¼‚å¸¸åˆ†ææŠ¥å‘Š</h1>
            <div class="report-info">
                <div>æŠ¥å‘Šç¼–å·: <input type="text" style="width: 4cm;" id="reportNumber"></div>
                <div>æŠ¥å‘Šæ—¥æœŸ: <input type="date" value="2025-08-04" id="reportDate"></div>
                <div>æŠ¥å‘ŠçŠ¶æ€: 
                    <select id="reportState">
                        <option value="draft">è‰ç¨¿</option>
                        <option value="pending">å¾…å®¡æ ¸</option>
                        <option value="approved">å·²å®¡æ‰¹</option>
                        <option value="closed">å·²é—­ç¯</option>
                    </select>
                </div>
            </div>
        </header>
        
        <!-- ä¸€ã€åŸºæœ¬ä¿¡æ¯ -->
        <div class="section">
            <h2 class="section-title">ä¸€ã€åŸºæœ¬ä¿¡æ¯</h2>
            
            <div class="two-column">
                <div class="column">
                    <div class="form-line">
                        <label>äº§å“ä»£ç :</label>
                        <input type="text" class="short-input" id="productCode">
                    </div>
                    <div class="form-line">
                        <label>äº§å“åç§°:</label>
                        <input type="text" class="short-input" id="productName">
                    </div>
                    <div class="form-line">
                        <label>ç”Ÿäº§æ‰¹å·:</label>
                        <input type="text" class="short-input" id="batchNumber">
                    </div>
                    <div class="form-line">
                        <label>å¯¹åº”è®¢å•å·:</label>
                        <input type="text" class="short-input" id="orderNumber">
                    </div>
                </div>
                <div class="column">
                    <div class="form-line">
                        <label>å¼‚å¸¸ç­‰çº§:</label>
                        <select class="short-input" id="anomalyLevel">
                            <option value="">è¯·é€‰æ‹©</option>
                            <option value="p1" class="priority-high">P1-ç´§æ€¥/å½±å“å‡ºè´§</option>
                            <option value="p2" class="priority-medium">P2-é‡è¦/æ‰¹é‡é£é™©</option>
                            <option value="p3" class="priority-low">P3-ä¸€èˆ¬/å•ä¸ªå¼‚å¸¸</option>
                        </select>
                    </div>
                    <div class="form-line">
                        <label>å“åº”è´Ÿè´£äºº:</label>
                        <input type="text" class="short-input" id="responsePerson">
                    </div>
                    <div class="form-line">
                        <label>è´£ä»»éƒ¨é—¨:</label>
                        <select class="short-input" id="responsibleDept">
                            <option value="">è¯·é€‰æ‹©</option>
                            <option value="production">ç”Ÿäº§éƒ¨</option>
                            <option value="quality">å“è´¨éƒ¨</option>
                            <option value="rd">ç ”å‘éƒ¨</option>
                            <option value="supply">ä¾›åº”é“¾</option>
                        </select>
                    </div>
                    <div class="form-line">
                        <label>ååŒéƒ¨é—¨:</label>
                        <input type="text" class="short-input" placeholder="å¤šä¸ªéƒ¨é—¨ç”¨é€—å·åˆ†éš”" id="cooperateDepts">
                    </div>
                </div>
            </div>
            
            <div class="two-column">
                <div class="column">
                    <div class="form-line">
                        <label>å¼‚å¸¸é—®é¢˜:</label>
                        <input type="text" class="short-input" id="anomalyProblem">
                    </div>
                </div>
                <div class="column">
                    <div class="form-line">
                        <label>ç”Ÿäº§è½¦é—´/çº¿:</label>
                        <input type="text" class="short-input" id="productionLine">
                    </div>
                </div>
            </div>
            
            <div class="guidance-text">
                <strong>å¼‚å¸¸ç­‰çº§åˆ¤å®šæ ‡å‡†ï¼š</strong>
                <ul>
                    <li><span class="priority-high">P1ï¼ˆç´§æ€¥ï¼‰</span>ï¼šå½±å“å‡ºè´§/æ‰¹é‡äº§å“å¤±æ•ˆ/å®¢æˆ·æŠ•è¯‰ä¸”éœ€ç«‹å³å¤„ç†ï¼Œ<span class="time-limit">å“åº”æ—¶é™â‰¤2å°æ—¶</span></li>
                    <li><span class="priority-medium">P2ï¼ˆé‡è¦ï¼‰</span>ï¼šéæ‰¹é‡ä½†å­˜åœ¨æ‰©æ•£é£é™©/å½±å“äº§å“æ ¸å¿ƒæ€§èƒ½ï¼Œ<span class="time-limit">å“åº”æ—¶é™â‰¤4å°æ—¶</span></li>
                    <li><span class="priority-low">P3ï¼ˆä¸€èˆ¬ï¼‰</span>ï¼šå•ä¸ª/å°‘é‡å¼‚å¸¸/ä¸å½±å“æ ¸å¿ƒåŠŸèƒ½ï¼Œ<span class="time-limit">å“åº”æ—¶é™â‰¤24å°æ—¶</span></li>
                </ul>
                <strong>æŠ¥å‘Šæäº¤æ—¶é™ï¼š</strong> P1ï¼š2å°æ—¶å†…æäº¤ï¼›P2ï¼š4å°æ—¶å†…ï¼›P3ï¼š24å°æ—¶å†…
            </div>
        </div>
        
        <!-- äºŒã€å¼‚å¸¸æè¿° -->
        <div class="section">
            <h2 class="section-title">äºŒã€å¼‚å¸¸æè¿°</h2>
            
            <div class="subsection">
                <h3 class="subsection-title">1. å¼‚å¸¸ç°è±¡</h3>
                <div class="form-group">
                    <label>é‡åŒ–æè¿°:</label>
                    <textarea placeholder="ä¾‹ï¼š30%äº§å“å‡ºç°å¤–å£³å¼€è£‚ï¼Œè£‚ç¼é•¿åº¦0.5-1cm" id="quantitativeDesc"></textarea>
                    <div class="guidance-text">è¯·æä¾›å…·ä½“é‡åŒ–æ•°æ®ï¼Œé¿å…æ¨¡ç³Šæè¿°</div>
                </div>
                <div class="form-group">
                    <label>ç°è±¡å¯¹æ¯”:</label>
                    <textarea placeholder="ä¾‹ï¼šä¸åˆæ ¼äº§å“ç›¸æ¯”ï¼Œå¼‚å¸¸äº§å“æŒ‰é”®å›å¼¹åŠ›åº¦ä¸è¶³3N" id="phenomenonCompare"></textarea>
                    <div class="guidance-text">ä¸æ­£å¸¸äº§å“å¯¹æ¯”ï¼Œçªå‡ºå·®å¼‚ç‚¹</div>
                </div>
                <div class="form-group">
                    <label>æ£€æµ‹æ ‡å‡†ä¾æ®:</label>
                    <input type="text" placeholder="ä¾‹ï¼šGB/T XXXX-2023ã€ŠXXäº§å“æŠ€æœ¯è§„èŒƒã€‹ç¬¬5.3æ¡" class="full-width" id="detectionStandard">
                </div>
            </div>
            
            <div class="subsection">
                <h3 class="subsection-title">2. å¼‚å¸¸éƒ¨ä½</h3>
                <div class="form-group">
                    <label>éƒ¨ä½åˆ†çº§:</label>
                    <select id="locationLevel">
                        <option value="">è¯·é€‰æ‹©</option>
                        <option value="whole">æ•´ä½“äº§å“</option>
                        <option value="core_component">æ ¸å¿ƒç»„ä»¶ï¼ˆå¦‚ä¸»æ¿ã€ç”µæ± ï¼‰</option>
                        <option value="auxiliary_component">è¾…åŠ©ç»„ä»¶ï¼ˆå¦‚å¤–å£³ã€æŒ‰é”®ï¼‰</option>
                        <option value="process_node">å·¥åºèŠ‚ç‚¹ï¼ˆå¦‚ç„Šæ¥ã€ç»„è£…ã€æ£€æµ‹ï¼‰</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>ç²¾å‡†æ ‡æ³¨:</label>
                    <textarea placeholder="ä¾‹ï¼šç”µæ± ä»“æ¥å£å¤„ï¼Œç„Šæ¥å·¥åºç¬¬3å·¥ä½" id="locationDetail"></textarea>
                    <div class="guidance-text">è¯·å°½å¯èƒ½ç²¾ç¡®æè¿°å¼‚å¸¸å‘ç”Ÿä½ç½®</div>
                </div>
            </div>
            
            <div class="subsection">
                <h3 class="subsection-title">3. å‘ç°ä¿¡æ¯</h3>
                <div class="two-column">
                    <div class="column">
                        <div class="form-line">
                            <label>å‘ç°äºº:</label>
                            <input type="text" class="short-input" id="discoverer">
                        </div>
                        <div class="form-line">
                            <label>å‘ç°ç¯èŠ‚:</label>
                            <select class="short-input" id="discoveryStage">
                                <option value="">è¯·é€‰æ‹©</option>
                                <option value="incoming">è¿›æ–™æ£€éªŒ</option>
                                <option value="process">åˆ¶ç¨‹</option>
                                <option value="final">æˆå“æ£€éªŒ</option>
                                <option value="client">å®¢æˆ·ç«¯</option>
                            </select>
                        </div>
                    </div>
                    <div class="column">
                        <div class="form-line">
                            <label>å‘ç°æ—¶é—´:</label>
                            <input type="datetime-local" class="short-input" id="discoveryTime">
                        </div>
                        <div class="form-line">
                            <label>é¦–æ¬¡åé¦ˆæ—¶é—´:</label>
                            <input type="datetime-local" class="short-input" id="firstFeedbackTime">
                        </div>
                    </div>
                </div>
                <div class="form-group">
                    <label>å®¢æˆ·ç«¯åœºæ™¯ç»†åˆ†:</label>
                    <select id="clientScenario">
                        <option value="">è¯·é€‰æ‹©</option>
                        <option value="inspection">å®¢æˆ·å…¥åº“æ£€éªŒ</option>
                        <option value="early_use">å®¢æˆ·ä½¿ç”¨åˆæœŸï¼ˆâ‰¤7å¤©ï¼‰</option>
                        <option value="mid_use">å®¢æˆ·ä½¿ç”¨ä¸­æœŸï¼ˆ7-30å¤©ï¼‰</option>
                        <option value="long_use">å®¢æˆ·ä½¿ç”¨é•¿æœŸï¼ˆï¼30å¤©ï¼‰</option>
                    </select>
                </div>
                <div class="guidance-text">å‘ç°ç¯èŠ‚åˆ¤å®šæ ‡å‡†ï¼šè¿›æ–™æ£€éªŒ-ä¾›åº”å•†æ¥æ–™æ—¶ï¼›åˆ¶ç¨‹-ç”Ÿäº§è¿‡ç¨‹ä¸­ç¬¬Xå·¥åºï¼›æˆå“æ£€éªŒ-å…¥åº“å‰ç»ˆæ£€ï¼›å®¢æˆ·ç«¯-å®¢æˆ·ä½¿ç”¨è¿‡ç¨‹ä¸­</div>
            </div>
            
            <div class="subsection">
                <h3 class="subsection-title">4. å¼‚å¸¸å›¾ç‰‡</h3>
                <div class="form-group">
                    <label>å›¾ç‰‡è¯´æ˜:</label>
                    <input type="text" placeholder="ä¾‹ï¼šå›¾1-æˆå“æ£€éªŒæ—¶å‘ç°çš„å¤–å£³å¼€è£‚å®ç‰©å›¾" class="full-width" id="imageDescription">
                </div>
                <div class="two-column">
                    <div class="column">
                        <div class="form-line">
                            <label>å›¾ç‰‡æ‹æ‘„äºº:</label>
                            <input type="text" id="photographer">
                        </div>
                    </div>
                    <div class="column">
                        <div class="form-line">
                            <label>æ‹æ‘„è®¾å¤‡:</label>
                            <input type="text" id="cameraDevice">
                        </div>
                    </div>
                </div>
                <div class="image-grid" id="anomaly-images">
                    <!-- å›¾ç‰‡å°†é€šè¿‡JSåŠ¨æ€æ·»åŠ  -->
                </div>
                <button class="image-upload-btn" onclick="document.getElementById('anomaly-image-upload').click()">ä¸Šä¼ å¼‚å¸¸å›¾ç‰‡ (æœ€å¤š5å¼ )</button>
                <input type="file" id="anomaly-image-upload" accept="image/*" multiple style="display: none;">
                <div class="guidance-text">å›¾ç‰‡æ‹æ‘„è¦æ±‚ï¼šå«å¼‚å¸¸éƒ¨ä½ç‰¹å†™ã€æ¯”ä¾‹å°ºå‚è€ƒã€æ‹æ‘„è§’åº¦ç»Ÿä¸€ï¼›è¯·æ ‡æ³¨"å¼‚å¸¸å‘ç”Ÿæ‰¹æ¬¡ä¸æ­£å¸¸æ‰¹æ¬¡å¯¹æ¯”å›¾"ï¼ˆè‹¥æœ‰ï¼‰</div>
            </div>
        </div>
        
        <!-- ä¸‰ã€å½±å“è¯„ä¼° -->
        <div class="section">
            <h2 class="section-title">ä¸‰ã€å½±å“è¯„ä¼°</h2>
            
            <div class="subsection">
                <h3 class="subsection-title">1. äº§å“å½±å“</h3>
                <div class="form-group">
                    <label>æ¶‰åŠç‰©æ–™:</label>
                    <input type="text" class="full-width" id="affectedMaterial">
                </div>
                <div class="two-column">
                    <div class="column">
                        <div class="form-line">
                            <label>æ¶‰åŠæ•°é‡:</label>
                            <input type="text" id="affectedQuantity"> ä»¶
                        </div>
                        <div class="form-line">
                            <label>ä¸è‰¯ç‡:</label>
                            <input type="text" id="defectRate"> %
                        </div>
                    </div>
                    <div class="column">
                        <div class="form-line">
                            <label>éš”ç¦»çŠ¶æ€:</label>
                            <select id="isolationStatus">
                                <option value="">è¯·é€‰æ‹©</option>
                                <option value="isolated">å·²éš”ç¦»</option>
                                <option value="pending">å¾…éš”ç¦»</option>
                                <option value="not_required">æ— éœ€éš”ç¦»</option>
                            </select>
                        </div>
                        <div class="form-line">
                            <label>éš”ç¦»åœ°ç‚¹:</label>
                            <input type="text" placeholder="ä¾‹ï¼šä¸åˆæ ¼å“åŒº-ç¼–å·A3" id="isolationLocation">
                        </div>
                    </div>
                </div>
                <div class="form-group">
                    <label>äº§å“é£é™©ç­‰çº§:</label>
                    <select id="productRiskLevel">
                        <option value="">è¯·é€‰æ‹©</option>
                        <option value="safety">å®‰å…¨é£é™©ï¼šå¯èƒ½å¯¼è‡´äººèº«ä¼¤å®³/è®¾å¤‡æŸå</option>
                        <option value="performance">æ€§èƒ½é£é™©ï¼šæ ¸å¿ƒåŠŸèƒ½ä¸è¾¾æ ‡ï¼Œå½±å“ä½¿ç”¨</option>
                        <option value="appearance">å¤–è§‚é£é™©ï¼šä»…å¤–è§‚ç‘•ç–µï¼Œä¸å½±å“åŠŸèƒ½</option>
                        <option value="function">åŠŸèƒ½å¤±æ•ˆé£é™©ï¼šéæ ¸å¿ƒåŠŸèƒ½å¤±æ•ˆï¼Œä¸å½±å“ä¸»è¦ä½¿ç”¨åœºæ™¯</option>
                    </select>
                </div>
            </div>
            
            <div class="subsection">
                <h3 class="subsection-title">2. ä¸šåŠ¡å½±å“</h3>
                <div class="form-group">
                    <label>ä¾›è´§æ¸ é“:</label>
                    <input type="text" class="short-input" placeholder="ä¾‹ï¼šç”µå•†æ¸ é“/çº¿ä¸‹ç»é”€å•†/ç›´ä¾›å®¢æˆ·" id="supplyChannel">
                </div>
                <div class="form-group">
                    <label>æ¸ é“ç±»å‹:</label>
                    <select id="channelType">
                        <option value="">è¯·é€‰æ‹©</option>
                        <option value="online">çº¿ä¸Š</option>
                        <option value="offline">çº¿ä¸‹</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>è®¢å•çŠ¶æ€:</label>
                    <select id="orderStatus">
                        <option value="">è¯·é€‰æ‹©</option>
                        <option value="not_shipped">æœªå‘è´§</option>
                        <option value="partially_shipped">éƒ¨åˆ†å‘è´§</option>
                        <option value="fully_shipped">å·²å…¨éƒ¨å‘è´§</option>
                        <option value="signed">å®¢æˆ·å·²ç­¾æ”¶</option>
                    </select>
                </div>
                <div class="two-column">
                    <div class="column">
                        <div class="form-line">
                            <label>ä¾›åº”æ•°é‡:</label>
                            <input type="text" id="supplyQuantity"> ä»¶
                        </div>
                    </div>
                    <div class="column">
                        <div class="form-line">
                            <label>è®¡åˆ’äº¤æœŸ:</label>
                            <input type="date" id="plannedDeliveryDate">
                        </div>
                    </div>
                </div>
                <div class="form-group">
                    <label>æ˜¯å¦å½±å“äº¤æœŸ:</label>
                    <select id="affectsDelivery">
                        <option value="">è¯·é€‰æ‹©</option>
                        <option value="yes">æ˜¯</option>
                        <option value="no">å¦</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>å»¶è¯¯å¤©æ•°é¢„ä¼°:</label>
                    <input type="text" id="delayDays"> å¤©
                </div>
                <div class="form-group">
                    <label>ç´§æ€¥è¡¥è´§/æ›¿ä»£æ–¹æ¡ˆ:</label>
                    <textarea placeholder="è¯¦ç»†æè¿°ç´§æ€¥è¡¥è´§æˆ–æ›¿ä»£æ–¹æ¡ˆ..." id="emergencyPlan"></textarea>
                </div>
                
                <h4 class="subsection-title">ç»æµæŸå¤±é¢„ä¼°</h4>
                <div class="two-column">
                    <div class="column">
                        <div class="form-line">
                            <label>è¿”å·¥æˆæœ¬:</label>
                            <input type="text" id="reworkCost"> å…ƒ
                        </div>
                        <div class="form-line">
                            <label>æŠ¥åºŸæˆæœ¬:</label>
                            <input type="text" id="scrapCost"> å…ƒ
                        </div>
                        <div class="form-line">
                            <label>åŠ æ€¥è¿è¾“æˆæœ¬:</label>
                            <input type="text" id="urgentShippingCost"> å…ƒ
                        </div>
                    </div>
                    <div class="column">
                        <div class="form-line">
                            <label>å®¢æˆ·ç´¢èµ”é¢„ä¼°:</label>
                            <input type="text" id="customerClaimCost"> å…ƒ
                        </div>
                        <div class="form-line">
                            <label>å…¶ä»–æŸå¤±:</label>
                            <input type="text" id="otherCost"> å…ƒ
                        </div>
                        <div class="form-line">
                            <label>æ€»æŸå¤±é¢„ä¼°:</label>
                            <input type="text" id="totalCost"> å…ƒ
                        </div>
                    </div>
                </div>
                <div class="form-group">
                    <label>æ ¸ç®—ä¾æ®:</label>
                    <textarea placeholder="ä¾‹ï¼šæŠ¥åºŸæˆæœ¬=æ¶‰åŠæ•°é‡Ã—å•ä½ç”Ÿäº§æˆæœ¬" id="costCalculationBasis"></textarea>
                </div>
            </div>
            
            <div class="subsection">
                <h3 class="subsection-title">3. å®¢è¯‰é£é™©</h3>
                <div class="form-group">
                    <label>é£é™©ç­‰çº§:</label>
                    <select id="complaintRiskLevel">
                        <option value="">è¯·é€‰æ‹©</option>
                        <option value="high" class="priority-high">é«˜</option>
                        <option value="medium" class="priority-medium">ä¸­</option>
                        <option value="low" class="priority-low">ä½</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>å®¢æˆ·ç±»å‹:</label>
                    <select id="customerType">
                        <option value="">è¯·é€‰æ‹©</option>
                        <option value="core">æ ¸å¿ƒå®¢æˆ·</option>
                        <option value="important">é‡è¦å®¢æˆ·</option>
                        <option value="general">æ™®é€šå®¢æˆ·</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>å®¢è¯‰åº”å¯¹æ—¶é™:</label>
                    <input type="text" placeholder="ä¾‹ï¼šæ ¸å¿ƒå®¢æˆ·â‰¤12å°æ—¶å“åº”" id="complaintResponseTime">
                </div>
                <div class="form-group">
                    <label>è¯„ä¼°ä¾æ®:</label>
                    <textarea placeholder="ä¾‹ï¼šé«˜é£é™©-å¼‚å¸¸å½±å“äº§å“æ ¸å¿ƒåŠŸèƒ½ï¼Œå®¢æˆ·ä½¿ç”¨ä¸­æ˜“å‘ç°" id="complaintAssessmentBasis"></textarea>
                </div>
            </div>
        </div>
        
        <!-- å››ã€å¼‚å¸¸å¤„ç† -->
        <div class="section">
            <h2 class="section-title">å››ã€å¼‚å¸¸å¤„ç†</h2>
            
            <div class="subsection">
                <h3 class="subsection-title">å¤„ç†æªæ–½</h3>
                <table class="improvement-table" id="treatment-table">
                    <thead>
                        <tr>
                            <th width="30%">å…·ä½“å¤„ç†æ–¹æ³•</th>
                            <th width="12%">å¤„ç†ä¼˜å…ˆçº§</th>
                            <th width="15%">å®Œæˆæ—¶é—´</th>
                            <th width="23%">å¤„ç†ç»“æœ</th>
                            <th width="15%">ç¡®è®¤äºº</th>
                            <th width="5%"></th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td><input type="text" placeholder="ä¾‹ï¼šéš”ç¦»æ‰€æœ‰å¼‚å¸¸äº§å“ï¼Œè¿›è¡Œå…¨æ£€" style="width: 100%; border: none;" id="treatmentMethod_0"></td>
                            <td>
                                <select style="width: 100%; border: none;" id="treatmentPriority_0">
                                    <option value="">è¯·é€‰æ‹©</option>
                                    <option value="high" class="priority-high">é«˜</option>
                                    <option value="medium" class="priority-medium">ä¸­</option>
                                    <option value="low" class="priority-low">ä½</option>
                                </select>
                            </td>
                            <td><input type="datetime-local" style="width: 100%; border: none;" id="treatmentCompleteTime_0"></td>
                            <td><input type="text" placeholder="ä¾‹ï¼šå·²éš”ç¦»500ä»¶ï¼Œå…¨æ£€å®Œæˆ" style="width: 100%; border: none;" id="treatmentResult_0"></td>
                            <td><input type="text" placeholder="ç¡®è®¤äºº" style="width: 100%; border: none;" id="treatmentConfirmer_0"></td>
                            <td><button class="remove-row-btn" onclick="removeRow(this)">X</button></td>
                        </tr>
                    </tbody>
                </table>
                <button class="add-row-btn" onclick="addTreatmentRow()">+ æ·»åŠ å¤„ç†æªæ–½</button>
                
                <div class="form-group">
                    <label>æ‰©æ•£æ§åˆ¶æªæ–½:</label>
                    <textarea placeholder="ä¾‹ï¼šæš‚åœå¯¹åº”ç”Ÿäº§çº¿ç”Ÿäº§/é€šçŸ¥ä¸‹æ¸¸å·¥åºéš”ç¦»" id="spreadControlMeasures"></textarea>
                </div>
                
                <div class="form-group">
                    <label>å¼‚å¸¸å¤„ç†å—é˜»è¯´æ˜:</label>
                    <textarea placeholder="ä¾‹ï¼šéœ€ç­‰å¾…ä¾›åº”å•†æä¾›æ›¿æ¢ç‰©æ–™ï¼Œé¢„è®¡å»¶è¯¯2å¤©" id="treatmentObstacles"></textarea>
                </div>
            </div>
        </div>
        
        <!-- äº”ã€æ ¹å› åˆ†æ -->
        <div class="section">
            <h2 class="section-title">äº”ã€æ ¹å› åˆ†æ</h2>
            
            <div class="subsection">
                <h3 class="subsection-title">åˆ†ææ–¹æ³•</h3>
                
                <div class="analysis-method">
                    <div class="method-title">1. é±¼éª¨å›¾åˆ†ææ³•ï¼ˆå› æœå›¾åˆ†ææ³•ï¼‰</div>
                    
                    <!-- é±¼éª¨å›¾ä¸Šä¼ åŒºåŸŸ -->
                    <div class="form-group">
                        <div class="image-placeholder" id="fishbone-placeholder">
                            [é±¼éª¨å›¾/å› æœåˆ†æå›¾ä¸Šä¼ åŒºåŸŸ]
                        </div>
                        <button class="image-upload-btn" onclick="document.getElementById('fishbone-upload').click()">ä¸Šä¼ åˆ†æå›¾</button>
                        <input type="file" id="fishbone-upload" accept="image/*" style="display: none;">
                    </div>
                    
                    <div class="form-group">
                        <label>äººå‘˜å› ç´ :</label>
                        <textarea placeholder="ï¼ˆæ“ä½œå¤±è¯¯ã€åŸ¹è®­ç¼ºå£ã€æŠ€èƒ½ä¸è¶³ç­‰ï¼‰" id="humanFactors"></textarea>
                        <div class="guidance-text">ç¤ºä¾‹ï¼šæ–°å‘˜å·¥æœªæŒ‰SOPæ“ä½œ/è€å‘˜å·¥è¿è§„ç®€åŒ–æ­¥éª¤</div>
                        <div class="form-line">
                            <label>æ˜¯å¦éªŒè¯:</label>
                            <select style="width: 20%;" id="humanVerified">
                                <option value="">è¯·é€‰æ‹©</option>
                                <option value="yes">æ˜¯</option>
                                <option value="no">å¦</option>
                            </select>
                            <label style="min-width: 2cm;">éªŒè¯ä¾æ®:</label>
                            <input type="text" placeholder="ä¾‹ï¼šåŸ¹è®­è®°å½•ç¼–å·XXX/ç°åœºæ“ä½œç›‘æ§å½•åƒç‰‡æ®µ" style="width: 65%;" id="humanVerificationBasis">
                        </div>
                        <div class="form-line">
                            <label>éªŒè¯äºº:</label>
                            <input type="text" style="width: 30%;" id="humanVerifier">
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label>è®¾å¤‡å› ç´ :</label>
                        <textarea placeholder="ï¼ˆè®¾å¤‡æ•…éšœã€ç²¾åº¦åå·®ã€ç»´æŠ¤ç¼ºå¤±ç­‰ï¼‰" id="equipmentFactors"></textarea>
                        <div class="guidance-text">ç¤ºä¾‹ï¼šè®¾å¤‡æœªæŒ‰å‘¨æœŸæ ¡å‡†/æ¨¡å…·ç£¨æŸè¶…è¿‡å…è®¸èŒƒå›´</div>
                        <div class="form-line">
                            <label>æ˜¯å¦éªŒè¯:</label>
                            <select style="width: 20%;" id="equipmentVerified">
                                <option value="">è¯·é€‰æ‹©</option>
                                <option value="yes">æ˜¯</option>
                                <option value="no">å¦</option>
                            </select>
                            <label style="min-width: 2cm;">éªŒè¯ä¾æ®:</label>
                            <input type="text" placeholder="ä¾‹ï¼šè®¾å¤‡ç»´æŠ¤è®°å½•ç¼–å·XXX/æ ¡å‡†æŠ¥å‘Šç¼–å·XXX" style="width: 65%;" id="equipmentVerificationBasis">
                        </div>
                        <div class="form-line">
                            <label>éªŒè¯äºº:</label>
                            <input type="text" style="width: 30%;" id="equipmentVerifier">
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label>ç‰©æ–™å› ç´ :</label>
                        <textarea placeholder="ï¼ˆæ¥æ–™é—®é¢˜ã€å­˜å‚¨å¼‚å¸¸ã€ç‰©æ–™å˜å¼‚ç­‰ï¼‰" id="materialFactors"></textarea>
                        <div class="guidance-text">ç¤ºä¾‹ï¼šä¾›åº”å•†æ¥æ–™æ‰¹æ¬¡ä¸è‰¯/å­˜å‚¨ç¯å¢ƒä¸ç¬¦åˆè¦æ±‚</div>
                        <div class="form-line">
                            <label>æ˜¯å¦éªŒè¯:</label>
                            <select style="width: 20%;" id="materialVerified">
                                <option value="">è¯·é€‰æ‹©</option>
                                <option value="yes">æ˜¯</option>
                                <option value="no">å¦</option>
                            </select>
                            <label style="min-width: 2cm;">éªŒè¯ä¾æ®:</label>
                            <input type="text" placeholder="ä¾‹ï¼šæ¥æ–™æ£€éªŒæŠ¥å‘Šç¼–å·XXX/å­˜å‚¨ç¯å¢ƒè®°å½•" style="width: 65%;" id="materialVerificationBasis">
                        </div>
                        <div class="form-line">
                            <label>éªŒè¯äºº:</label>
                            <input type="text" style="width: 30%;" id="materialVerifier">
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label>æ–¹æ³•å› ç´ :</label>
                        <textarea placeholder="ï¼ˆå·¥è‰ºå‚æ•°ã€ä½œä¸šæŒ‡å¯¼ä¹¦ã€æµç¨‹æ¼æ´ç­‰ï¼‰" id="methodFactors"></textarea>
                        <div class="guidance-text">ç¤ºä¾‹ï¼šå·¥è‰ºå‚æ•°è®¾ç½®ä¸å½“/SOPæ­¥éª¤ç¼ºå¤±</div>
                        <div class="form-line">
                            <label>æ˜¯å¦éªŒè¯:</label>
                            <select style="width: 20%;" id="methodVerified">
                                <option value="">è¯·é€‰æ‹©</option>
                                <option value="yes">æ˜¯</option>
                                <option value="no">å¦</option>
                            </select>
                            <label style="min-width: 2cm;">éªŒè¯ä¾æ®:</label>
                            <input type="text" placeholder="ä¾‹ï¼šSOPæ–‡ä»¶ç‰ˆæœ¬XXX/å·¥è‰ºå‚æ•°è®°å½•" style="width: 65%;" id="methodVerificationBasis">
                        </div>
                        <div class="form-line">
                            <label>éªŒè¯äºº:</label>
                            <input type="text" style="width: 30%;" id="methodVerifier">
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label>ç¯å¢ƒå› ç´ :</label>
                        <textarea placeholder="ï¼ˆæ¸©æ¹¿åº¦ã€æ´å‡€åº¦ã€å…‰ç…§ç­‰ï¼‰" id="environmentFactors"></textarea>
                        <div class="guidance-text">ç¤ºä¾‹ï¼šæ¸©æ¹¿åº¦ä¸ç¬¦åˆæ ‡å‡†ï¼ˆ23Â±2â„ƒï¼Œ50Â±5%RHï¼‰</div>
                        <div class="form-line">
                            <label>æ˜¯å¦éªŒè¯:</label>
                            <select style="width: 20%;" id="environmentVerified">
                                <option value="">è¯·é€‰æ‹©</option>
                                <option value="yes">æ˜¯</option>
                                <option value="no">å¦</option>
                            </select>
                            <label style="min-width: 2cm;">éªŒè¯ä¾æ®:</label>
                            <input type="text" placeholder="ä¾‹ï¼šç¯å¢ƒç›‘æµ‹è®°å½•ç¼–å·XXX" style="width: 65%;" id="environmentVerificationBasis">
                        </div>
                        <div class="form-line">
                            <label>éªŒè¯äºº:</label>
                            <input type="text" style="width: 30%;" id="environmentVerifier">
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label>æµ‹é‡å› ç´ :</label>
                        <textarea placeholder="ï¼ˆæµ‹é‡è®¾å¤‡ã€æµ‹é‡æ–¹æ³•ã€æ ‡å‡†ä¸ç»Ÿä¸€ç­‰ï¼‰" id="measurementFactors"></textarea>
                        <div class="guidance-text">ç¤ºä¾‹ï¼šæµ‹é‡è®¾å¤‡ç²¾åº¦ä¸è¶³/æ£€æµ‹æ ‡å‡†ä¸æ˜ç¡®</div>
                        <div class="form-line">
                            <label>æ˜¯å¦éªŒè¯:</label>
                            <select style="width: 20%;" id="measurementVerified">
                                <option value="">è¯·é€‰æ‹©</option>
                                <option value="yes">æ˜¯</option>
                                <option value="no">å¦</option>
                            </select>
                            <label style="min-width: 2cm;">éªŒè¯ä¾æ®:</label>
                            <input type="text" placeholder="ä¾‹ï¼šæµ‹é‡è®¾å¤‡æ ¡å‡†è®°å½•ç¼–å·XXX" style="width: 65%;" id="measurementVerificationBasis">
                        </div>
                        <div class="form-line">
                            <label>éªŒè¯äºº:</label>
                            <input type="text" style="width: 30%;" id="measurementVerifier">
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label>æ’é™¤å› ç´ è¯´æ˜:</label>
                        <textarea placeholder="ä¾‹ï¼šç¯å¢ƒå› ç´ -æ¸©æ¹¿åº¦ç¬¦åˆæ ‡å‡†ï¼ˆ23Â±2â„ƒï¼Œ50Â±5%RHï¼‰ï¼Œå·²æ’é™¤" id="excludedFactors"></textarea>
                    </div>
                    
                    <div class="main-cause">
                        <div class="form-group">
                            <label>ä¸»è¦åŸå› æè¿°:</label>
                            <textarea placeholder="ï¼ˆé€šè¿‡é±¼éª¨å›¾åˆ†æç¡®å®šçš„ä¸»è¦åŸå› ï¼‰" id="mainCauseDescription"></textarea>
                        </div>
                    </div>
                </div>
                
                <div class="analysis-method">
                    <div class="method-title">2. 5Whyåˆ†ææ³•</div>
                    <div class="form-group">
                        <label>é’ˆå¯¹ä¸»è¦åŸå› :</label>
                        <input type="text" class="full-width" placeholder="ï¼ˆå¡«å†™ä»é±¼éª¨å›¾åˆ†æå¾—å‡ºçš„ä¸»è¦åŸå› ï¼‰" id="fiveWhyMainCause">
                    </div>
                    
                    <div class="form-group">
                        <label>ç¬¬ä¸€å±‚åŸå› ï¼ˆç›´æ¥åŸå› ï¼‰:</label>
                        <input type="text" class="full-width" placeholder="ç›´æ¥å¯¼è‡´å¼‚å¸¸å‘ç”Ÿçš„åŸå› " id="why1">
                        <div class="form-line">
                            <label>éªŒè¯æ–¹å¼:</label>
                            <input type="text" placeholder="ä¾‹ï¼šæ ¸æŸ¥è®¾å¤‡è¿è¡Œæ—¥å¿—" class="full-width" id="why1Verification">
                        </div>
                        <div class="form-line">
                            <label>æ˜¯å¦é—­ç¯:</label>
                            <select style="width: 30%;" id="why1Closed">
                                <option value="">è¯·é€‰æ‹©</option>
                                <option value="yes">æ˜¯</option>
                                <option value="no">å¦</option>
                                <option value="pending">å¾…é—­ç¯</option>
                            </select>
                        </div>
                        <div class="form-line">
                            <label>åç»­è·Ÿè¿›è®¡åˆ’:</label>
                            <input type="text" placeholder="ä¾‹ï¼šè®¡åˆ’3ä¸ªå·¥ä½œæ—¥å†…æ ¸æŸ¥å·¡æ£€è®°å½•å®Œæ•´æ€§" class="full-width" id="why1FollowUp">
                        </div>
                        <div class="form-line">
                            <label>ä¸­é—´çº æ­£æªæ–½:</label>
                            <input type="text" placeholder="é’ˆå¯¹æ­¤å±‚åŸå› çš„ä¸´æ—¶åº”å¯¹æªæ–½" class="full-width" id="why1CorrectiveAction">
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label>ç¬¬äºŒå±‚åŸå› ï¼ˆä¸ºä»€ä¹ˆå‘ç”Ÿï¼Ÿï¼‰:</label>
                        <input type="text" class="full-width" placeholder="å¯¼è‡´ç¬¬ä¸€å±‚åŸå› çš„åŸå› " id="why2">
                        <div class="form-line">
                            <label>éªŒè¯æ–¹å¼:</label>
                            <input type="text" placeholder="ä¾‹ï¼šæŸ¥çœ‹å·¡æ£€è®°å½•" class="full-width" id="why2Verification">
                        </div>
                        <div class="form-line">
                            <label>æ˜¯å¦é—­ç¯:</label>
                            <select style="width: 30%;" id="why2Closed">
                                <option value="">è¯·é€‰æ‹©</option>
                                <option value="yes">æ˜¯</option>
                                <option value="no">å¦</option>
                                <option value="pending">å¾…é—­ç¯</option>
                            </select>
                        </div>
                        <div class="form-line">
                            <label>åç»­è·Ÿè¿›è®¡åˆ’:</label>
                            <input type="text" placeholder="åç»­è·Ÿè¿›è®¡åˆ’" class="full-width" id="why2FollowUp">
                        </div>
                        <div class="form-line">
                            <label>ä¸­é—´çº æ­£æªæ–½:</label>
                            <input type="text" placeholder="é’ˆå¯¹æ­¤å±‚åŸå› çš„ä¸´æ—¶åº”å¯¹æªæ–½" class="full-width" id="why2CorrectiveAction">
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label>ç¬¬ä¸‰å±‚åŸå› ï¼ˆä¸ºä»€ä¹ˆæœªå‘ç°ï¼Ÿï¼‰:</label>
                        <input type="text" class="full-width" placeholder="ä¸ºä»€ä¹ˆå¼‚å¸¸æœªè¢«åŠæ—¶å‘ç°" id="why3">
                        <div class="form-line">
                            <label>éªŒè¯æ–¹å¼:</label>
                            <input type="text" placeholder="ä¾‹ï¼šæ£€æŸ¥æ£€æµ‹è®°å½•" class="full-width" id="why3Verification">
                        </div>
                        <div class="form-line">
                            <label>æ˜¯å¦é—­ç¯:</label>
                            <select style="width: 30%;" id="why3Closed">
                                <option value="">è¯·é€‰æ‹©</option>
                                <option value="yes">æ˜¯</option>
                                <option value="no">å¦</option>
                                <option value="pending">å¾…é—­ç¯</option>
                            </select>
                        </div>
                        <div class="form-line">
                            <label>åç»­è·Ÿè¿›è®¡åˆ’:</label>
                            <input type="text" placeholder="åç»­è·Ÿè¿›è®¡åˆ’" class="full-width" id="why3FollowUp">
                        </div>
                        <div class="form-line">
                            <label>ä¸­é—´çº æ­£æªæ–½:</label>
                            <input type="text" placeholder="é’ˆå¯¹æ­¤å±‚åŸå› çš„ä¸´æ—¶åº”å¯¹æªæ–½" class="full-width" id="why3CorrectiveAction">
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label>ç¬¬å››å±‚åŸå› ï¼ˆä¸ºä»€ä¹ˆç³»ç»Ÿå…è®¸ï¼Ÿï¼‰:</label>
                        <input type="text" class="full-width" placeholder="ä¸ºä»€ä¹ˆç³»ç»Ÿ/æµç¨‹å…è®¸æ­¤é—®é¢˜å‘ç”Ÿ" id="why4">
                        <div class="form-line">
                            <label>éªŒè¯æ–¹å¼:</label>
                            <input type="text" placeholder="ä¾‹ï¼šå®¡æ ¸SOPå’Œæµç¨‹æ–‡ä»¶" class="full-width" id="why4Verification">
                        </div>
                        <div class="form-line">
                            <label>æ˜¯å¦é—­ç¯:</label>
                            <select style="width: 30%;" id="why4Closed">
                                <option value="">è¯·é€‰æ‹©</option>
                                <option value="yes">æ˜¯</option>
                                <option value="no">å¦</option>
                                <option value="pending">å¾…é—­ç¯</option>
                            </select>
                        </div>
                        <div class="form-line">
                            <label>åç»­è·Ÿè¿›è®¡åˆ’:</label>
                            <input type="text" placeholder="åç»­è·Ÿè¿›è®¡åˆ’" class="full-width" id="why4FollowUp">
                        </div>
                        <div class="form-line">
                            <label>ä¸­é—´çº æ­£æªæ–½:</label>
                            <input type="text" placeholder="é’ˆå¯¹æ­¤å±‚åŸå› çš„ä¸´æ—¶åº”å¯¹æªæ–½" class="full-width" id="why4CorrectiveAction">
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label>ç¬¬äº”å±‚åŸå› ï¼ˆæ ¹æœ¬åŸå› ï¼‰:</label>
                        <input type="text" class="full-width" placeholder="é—®é¢˜çš„æ ¹æœ¬åŸå› " id="why5">
                        <div class="form-line">
                            <label>éªŒè¯æ–¹å¼:</label>
                            <input type="text" placeholder="ä¾‹ï¼šæ ¹æœ¬åŸå› éªŒè¯ç»“æœ" class="full-width" id="why5Verification">
                        </div>
                        <div class="form-line">
                            <label>æ˜¯å¦é—­ç¯:</label>
                            <select style="width: 30%;" id="why5Closed">
                                <option value="">è¯·é€‰æ‹©</option>
                                <option value="yes">æ˜¯</option>
                                <option value="no">å¦</option>
                                <option value="pending">å¾…é—­ç¯</option>
                            </select>
                        </div>
                    </div>
                </div>
                
                <div class="main-cause">
                    <div class="form-group">
                        <label>æ ¹å› éªŒè¯ç»“æœ:</label>
                        <textarea placeholder="ä¾‹ï¼šè°ƒæ•´è®¾å¤‡å‚æ•°åï¼Œå¼‚å¸¸ç‡ä»15%é™è‡³0.2%ï¼ŒéªŒè¯æ ¹å› ä¸ºè®¾å¤‡å‚æ•°åç§»" id="rootCauseVerificationResult"></textarea>
                        <div class="guidance-text">è¯·è¯´æ˜å¦‚ä½•ç¡®è®¤è¯¥æ ¹å› ä¸ºçœŸæ­£åŸå› </div>
                    </div>
                    <div class="two-column">
                        <div class="column">
                            <div class="form-line">
                                <label>éªŒè¯ç±»å‹:</label>
                                <select id="verificationType">
                                    <option value="">è¯·é€‰æ‹©</option>
                                    <option value="lab">å®éªŒå®¤å°æ‰¹é‡éªŒè¯</option>
                                    <option value="production">ç”Ÿäº§çº¿é‡äº§éªŒè¯</option>
                                </select>
                            </div>
                        </div>
                        <div class="column">
                            <div class="form-line">
                                <label>éªŒè¯æ ·æœ¬é‡:</label>
                                <input type="text" placeholder="ä¾‹ï¼šé‡äº§éªŒè¯æ ·æœ¬é‡=500ä»¶" id="verificationSampleSize">
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- å…­ã€æ”¹å–„æªæ–½ -->
        <div class="section">
            <h2 class="section-title">å…­ã€æ”¹å–„æªæ–½</h2>
            
            <div class="subsection">
                <h3 class="subsection-title">1. ä¸´æ—¶çº æ­£æªæ–½</h3>
                <table class="improvement-table" id="temporary-measures-table">
                    <thead>
                        <tr>
                            <th width="35%">æªæ–½å†…å®¹</th>
                            <th width="12%">è´£ä»»äºº</th>
                            <th width="12%">å®ŒæˆæœŸé™</th>
                            <th width="21%">éªŒæ”¶æ ‡å‡†</th>
                            <th width="10%">ä¼˜å…ˆçº§</th>
                            <th width="10%"></th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td><input type="text" placeholder="ä¾‹ï¼šå“è´¨éƒ¨å®Œæˆç°æœ‰åº“å­˜5000ä»¶äº§å“å…¨æ£€" style="width: 100%; border: none;" id="tempMeasureContent_0"></td>
                            <td><input type="text" placeholder="è´£ä»»äºº" style="width: 100%; border: none;" id="tempMeasurePerson_0"></td>
                            <td><input type="date" style="width: 100%; border: none;" id="tempMeasureDeadline_0"></td>
                            <td><input type="text" placeholder="ä¾‹ï¼šä¸è‰¯å“100%éš”ç¦»" style="width: 100%; border: none;" id="tempMeasureStandard_0"></td>
                            <td>
                                <select style="width: 100%; border: none;" id="tempMeasurePriority_0">
                                    <option value="">è¯·é€‰æ‹©</option>
                                    <option value="high" class="priority-high">é«˜</option>
                                    <option value="medium" class="priority-medium">ä¸­</option>
                                    <option value="low" class="priority-low">ä½</option>
                                </select>
                            </td>
                            <td><button class="remove-row-btn" onclick="removeRow(this)">X</button></td>
                        </tr>
                    </tbody>
                </table>
                <button class="add-row-btn" onclick="addRow('temporary-measures-table')">+ æ·»åŠ ä¸´æ—¶çº æ­£æªæ–½</button>
            </div>
            
            <div class="subsection">
                <h3 class="subsection-title">2. é•¿æœŸé¢„é˜²æªæ–½</h3>
                <table class="improvement-table" id="long-term-measures-table">
                    <thead>
                        <tr>
                            <th width="35%">æªæ–½å†…å®¹</th>
                            <th width="12%">è´£ä»»äºº</th>
                            <th width="12%">å®ŒæˆæœŸé™</th>
                            <th width="21%">éªŒæ”¶æ ‡å‡†</th>
                            <th width="10%">ä¼˜å…ˆçº§</th>
                            <th width="10%"></th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td><input type="text" placeholder="ä¾‹ï¼šç”Ÿäº§éƒ¨æ›´æ–°SOPï¼Œå¢åŠ æŒ‰é”®å›å¼¹åŠ›åº¦æ£€æµ‹æ­¥éª¤" style="width: 100%; border: none;" id="longMeasureContent_0"></td>
                            <td><input type="text" placeholder="è´£ä»»äºº" style="width: 100%; border: none;" id="longMeasurePerson_0"></td>
                            <td><input type="date" style="width: 100%; border: none;" id="longMeasureDeadline_0"></td>
                            <td><input type="text" placeholder="ä¾‹ï¼šSOPå®¡æ‰¹é€šè¿‡å¹¶å…¨å‘˜åŸ¹è®­åˆ°ä½" style="width: 100%; border: none;" id="longMeasureStandard_0"></td>
                            <td>
                                <select style="width: 100%; border: none;" id="longMeasurePriority_0">
                                    <option value="">è¯·é€‰æ‹©</option>
                                    <option value="high" class="priority-high">é«˜</option>
                                    <option value="medium" class="priority-medium">ä¸­</option>
                                    <option value="low" class="priority-low">ä½</option>
                                </select>
                            </td>
                            <td><button class="remove-row-btn" onclick="removeRow(this)">X</button></td>
                        </tr>
                    </tbody>
                </table>
                <button class="add-row-btn" onclick="addRow('long-term-measures-table')">+ æ·»åŠ é•¿æœŸé¢„é˜²æªæ–½</button>
                
                <div class="form-group">
                    <label>æœ‰æ•ˆæ€§è¯„ä¼°å‘¨æœŸ:</label>
                    <input type="text" placeholder="ä¾‹ï¼šæ¯æœˆå¤æ ¸1æ¬¡ï¼ŒæŒç»­3ä¸ªæœˆæ— å¼‚å¸¸åˆ™å»¶é•¿è‡³å­£åº¦å¤æ ¸" id="effectivenessEvaluationPeriod">
                </div>
            </div>
            
            <div class="subsection">
                <h3 class="subsection-title">3. æªæ–½èµ„æºéœ€æ±‚</h3>
                <table class="improvement-table" id="resource-table">
                    <thead>
                        <tr>
                            <th width="15%">èµ„æºç±»å‹</th>
                            <th width="30%">éœ€æ±‚æè¿°</th>
                            <th width="10%">ä¼˜å…ˆçº§</th>
                            <th width="15%">èµ„æºåˆ°ä½æ—¶é™</th>
                            <th width="20%">èµ„æºæä¾›éƒ¨é—¨</th>
                            <th width="10%"></th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>
                                <select style="width: 100%; border: none;" id="resourceType_0">
                                    <option value="">è¯·é€‰æ‹©</option>
                                    <option value="human">äººåŠ›</option>
                                    <option value="material">ç‰©åŠ›</option>
                                    <option value="technical">æŠ€æœ¯</option>
                                    <option value="financial">èµ„é‡‘</option>
                                </select>
                            </td>
                            <td><input type="text" placeholder="éœ€æ±‚æè¿°" style="width: 100%; border: none;" id="resourceDescription_0"></td>
                            <td>
                                <select style="width: 100%; border: none;" id="resourcePriority_0">
                                    <option value="">è¯·é€‰æ‹©</option>
                                    <option value="high" class="priority-high">é«˜</option>
                                    <option value="medium" class="priority-medium">ä¸­</option>
                                    <option value="low" class="priority-low">ä½</option>
                                </select>
                            </td>
                            <td><input type="date" style="width: 100%; border: none;" id="resourceDeadline_0"></td>
                            <td><input type="text" placeholder="èµ„æºæä¾›éƒ¨é—¨" style="width: 100%; border: none;" id="resourceDepartment_0"></td>
                            <td><button class="remove-row-btn" onclick="removeRow(this)">X</button></td>
                        </tr>
                    </tbody>
                </table>
                <button class="add-row-btn" onclick="addResourceRow()">+ æ·»åŠ èµ„æºéœ€æ±‚</button>
            </div>
            
            <div class="subsection">
                <h3 class="subsection-title">4. æ”¹å–„æªæ–½é£é™©é¢„åˆ¤</h3>
                <table class="improvement-table" id="risk-table">
                    <thead>
                        <tr>
                            <th width="30%">æ½œåœ¨é£é™©</th>
                            <th width="15%">é£é™©ç­‰çº§</th>
                            <th width="35%">åº”å¯¹é¢„æ¡ˆ</th>
                            <th width="15%">è´£ä»»äºº</th>
                            <th width="5%"></th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td><input type="text" placeholder="ä¾‹ï¼šæ–°SOPåŸ¹è®­è¦†ç›–ä¸å…¨é¢" style="width: 100%; border: none;" id="riskPotential_0"></td>
                            <td>
                                <select style="width: 100%; border: none;" id="riskLevel_0">
                                    <option value="">è¯·é€‰æ‹©</option>
                                    <option value="high" class="priority-high">é«˜</option>
                                    <option value="medium" class="priority-medium">ä¸­</option>
                                    <option value="low" class="priority-low">ä½</option>
                                </select>
                            </td>
                            <td><input type="text" placeholder="ä¾‹ï¼šå¢åŠ åŸ¹è®­è€ƒæ ¸ç¯èŠ‚ï¼Œæœªé€šè¿‡è€…æš‚åœä¸Šå²—" style="width: 100%; border: none;" id="riskResponse_0"></td>
                            <td><input type="text" placeholder="è´£ä»»äºº" style="width: 100%; border: none;" id="riskPerson_0"></td>
                            <td><button class="remove-row-btn" onclick="removeRow(this)">X</button></td>
                        </tr>
                    </tbody>
                </table>
                <button class="add-row-btn" onclick="addRiskRow()">+ æ·»åŠ é£é™©é¢„åˆ¤</button>
            </div>
            
            <div class="subsection">
                <h3 class="subsection-title">5. æªæ–½å®æ–½è®¡åˆ’å›¾</h3>
                <div class="form-group">
                    <div class="image-placeholder" id="improvement-placeholder">
                        [æ”¹å–„æªæ–½ç”˜ç‰¹å›¾ä¸Šä¼ åŒºåŸŸ]
                    </div>
                    <button class="image-upload-btn" onclick="document.getElementById('improvement-upload').click()">ä¸Šä¼ æ”¹å–„æªæ–½å›¾</button>
                    <input type="file" id="improvement-upload" accept="image/*" style="display: none;">
                </div>
            </div>
        </div>
        
        <!-- ä¸ƒã€æ•ˆæœéªŒè¯ -->
        <div class="section">
            <h2 class="section-title">ä¸ƒã€æ•ˆæœéªŒè¯</h2>
            
            <div class="subsection">
                <h3 class="subsection-title">1. æ”¹å–„è¿½è¸ª</h3>
                <div class="form-group">
                    <label>æ•´æ”¹è¯æ®:</label>
                    <textarea placeholder="ï¼ˆè®¾å¤‡éªŒæ”¶æŠ¥å‘Š/åŸ¹è®­ç­¾åˆ°è¡¨ï¼‰" id="improvementEvidence"></textarea>
                    <div class="guidance-text">è¯·æ˜ç¡®æäº¤å½¢å¼ï¼ˆç”µå­ç‰ˆ/çº¸è´¨ç‰ˆ/ç³»ç»Ÿä¸Šä¼ è·¯å¾„ï¼‰</div>
                </div>
                <div class="form-group">
                    <label>å¯¹æ¯”æ•°æ®:</label>
                    <textarea placeholder="ï¼ˆæ”¹å–„å‰åè‰¯ç‡/æ•…éšœç‡å˜åŒ–ï¼‰" id="improvementComparison"></textarea>
                    <div class="guidance-text">ä¾‹ï¼šæ”¹å–„å‰è‰¯ç‡85%ï¼Œæ”¹å–„åè‰¯ç‡99.5%ï¼›æ”¹å–„å‰æ•…éšœç‡12%ï¼Œæ”¹å–„åæ•…éšœç‡0.3%ï¼Œæ•°æ®é‡‡é›†å‘¨æœŸï¼šè¿ç»­3æ‰¹æ¬¡ç”Ÿäº§</div>
                </div>
                <div class="form-group">
                    <label>æ•°æ®é‡‡é›†æ¡ä»¶è¯´æ˜:</label>
                    <textarea placeholder="æ•°æ®é‡‡é›†ç¯å¢ƒï¼ˆæ¸©æ¹¿åº¦ã€ç”Ÿäº§è®¾å¤‡å‹å·ï¼‰ã€æ£€æµ‹è®¾å¤‡ï¼ˆå‹å·+æ ¡å‡†çŠ¶æ€ï¼‰ã€é‡‡æ ·æ–¹æ³•ï¼ˆéšæœºé‡‡æ ·/å…¨æ£€ï¼‰" id="dataCollectionConditions"></textarea>
                </div>
                <div class="two-column">
                    <div class="column">
                        <div class="form-line">
                            <label>éªŒè¯äººå‘˜:</label>
                            <input type="text" id="verificationPerson">
                        </div>
                    </div>
                    <div class="column">
                        <div class="form-line">
                            <label>éªŒè¯æ—¥æœŸ:</label>
                            <input type="date" id="verificationDate">
                        </div>
                    </div>
                </div>
                <div class="form-group">
                    <label>å¼‚å¸¸å¤å‘ç‡:</label>
                    <input type="text" placeholder="ä¾‹ï¼šæ”¹å–„åè¿ç»­5æ‰¹æ¬¡å¼‚å¸¸å¤å‘ç‡=0%" id="recurrenceRate">
                </div>
            </div>
            
            <div class="subsection">
                <h3 class="subsection-title">2. å®¢æˆ·åé¦ˆ</h3>
                <div class="form-group">
                    <label>åé¦ˆå‘¨æœŸ:</label>
                    <input type="text" placeholder="ä¾‹ï¼šæ”¹å–„å1ä¸ªæœˆå†…/3ä¸ªæ‰¹æ¬¡å†…" id="feedbackPeriod">
                </div>
                <div class="two-column">
                    <div class="column">
                        <div class="form-line">
                            <label>å®¢è¯‰ç‡:</label>
                            <input type="text" id="complaintRate"> %
                        </div>
                        <div class="form-line">
                            <label>å®¢æˆ·é€€è´§ç‡:</label>
                            <input type="text" id="returnRate"> %
                        </div>
                    </div>
                    <div class="column">
                        <div class="form-line">
                            <label>æŠ•è¯‰é‡:</label>
                            <input type="text" id="complaintCount"> ä»¶
                        </div>
                        <div class="form-line">
                            <label>å¤„ç†æ»¡æ„åº¦:</label>
                            <input type="text" id="satisfactionRate"> %
                        </div>
                    </div>
                </div>
                <div class="form-group">
                    <label>å®¢è¯‰æƒ…å†µ:</label>
                    <textarea placeholder="ï¼ˆè¯¦ç»†æè¿°å®¢è¯‰æƒ…å†µï¼‰" id="complaintDetails"></textarea>
                </div>
                <div class="form-group">
                    <label>å®¢æˆ·ç¡®è®¤çŠ¶æ€:</label>
                    <select id="customerConfirmation">
                        <option value="">è¯·é€‰æ‹©</option>
                        <option value="not_confirmed">æœªç¡®è®¤</option>
                        <option value="oral_confirmed">å£å¤´ç¡®è®¤</option>
                        <option value="written_confirmed">ä¹¦é¢ç¡®è®¤</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>æ— å®¢è¯‰è¯æ˜è¦æ±‚:</label>
                    <textarea placeholder="ä¾‹ï¼šè¿ç»­2ä¸ªæœˆæ— ç›¸å…³å®¢è¯‰ï¼Œå®¢æˆ·åé¦ˆç¡®è®¤è¡¨è§é™„ä»¶" id="noComplaintRequirement"></textarea>
                </div>
            </div>
        </div>
        
        <!-- å…«ã€é¢„é˜²æœºåˆ¶ -->
        <div class="section">
            <h2 class="section-title">å…«ã€é¢„é˜²æœºåˆ¶</h2>
            
            <div class="subsection">
                <h3 class="subsection-title">é¢„é˜²æªæ–½</h3>
                <div class="form-group">
                    <label>åˆ¶åº¦/æµç¨‹ä¼˜åŒ–:</label>
                    <textarea placeholder="ä¾‹ï¼šæ›´æ–°ã€Šè®¾å¤‡å·¡æ£€SOPã€‹ï¼Œå¢åŠ æ¯æ—¥å‚æ•°æ ¡å‡†ç¯èŠ‚" id="processOptimization"></textarea>
                </div>
                <div class="form-group">
                    <label>åŸ¹è®­å¼ºåŒ–:</label>
                    <textarea placeholder="ä¾‹ï¼šå¯¹ç”Ÿäº§å‘˜å·¥å¼€å±•å¼‚å¸¸è¯†åˆ«åŸ¹è®­ï¼Œæ¯æœˆ1æ¬¡ï¼Œè€ƒæ ¸é€šè¿‡ç‡100%" id="trainingStrengthening"></textarea>
                </div>
                <div class="form-group">
                    <label>ç›‘æ§ä½“ç³»å‡çº§:</label>
                    <textarea placeholder="ä¾‹ï¼šåœ¨å…³é”®å·¥åºæ–°å¢è§†è§‰æ£€æµ‹è®¾å¤‡ï¼Œå®æ—¶ç›‘æ§å¼‚å¸¸" id="monitoringUpgrade"></textarea>
                </div>
                <div class="form-group">
                    <label>ä¾›åº”å•†ç®¡ç†ä¼˜åŒ–:</label>
                    <textarea placeholder="ä¾‹ï¼šå¯¹æ¥æ–™ä¾›åº”å•†å¢åŠ å¼‚å¸¸æ‰¹æ¬¡çš„æº¯æºå®¡æ ¸ï¼Œå­£åº¦è¯„åˆ†æŒ‚é’©åˆä½œä»½é¢" id="supplierOptimization"></textarea>
                </div>
            </div>
            
            <div class="subsection">
                <h3 class="subsection-title">è½åœ°ä¿éšœ</h3>
                <div class="two-column">
                    <div class="column">
                        <div class="form-line">
                            <label>é¢„é˜²æªæ–½è´£ä»»äºº:</label>
                            <input type="text" id="preventionPerson">
                        </div>
                        <div class="form-line">
                            <label>è®¡åˆ’å®Œæˆæ—¶é—´:</label>
                            <input type="date" id="preventionDeadline">
                        </div>
                    </div>
                    <div class="column">
                        <div class="form-line">
                            <label>å®šæœŸéªŒè¯å‘¨æœŸ:</label>
                            <input type="text" placeholder="ä¾‹ï¼šæ¯æœˆæ ¸æŸ¥1æ¬¡è®¾å¤‡å·¡æ£€æ‰§è¡Œæƒ…å†µ" id="regularVerificationPeriod">
                        </div>
                        <div class="form-line">
                            <label>éªŒè¯æ–¹å¼:</label>
                            <select id="verificationMethod">
                                <option value="">è¯·é€‰æ‹©</option>
                                <option value="site_check">ç°åœºæ ¸æŸ¥</option>
                                <option value="document_review">æ–‡ä»¶å®¡æ ¸</option>
                                <option value="data_analysis">æ•°æ®ç»Ÿè®¡åˆ†æ</option>
                            </select>
                        </div>
                    </div>
                </div>
                <div class="form-group">
                    <label>éªŒè¯è´£ä»»äºº:</label>
                    <input type="text" id="verificationResponsiblePerson">
                </div>
                <div class="form-group">
                    <label>éªŒè¯ç»“æœä¸ŠæŠ¥è·¯å¾„:</label>
                    <input type="text" placeholder="ä¾‹ï¼šéªŒè¯ç»“æœéœ€ä¸ŠæŠ¥å“è´¨éƒ¨ç»ç†" id="verificationReportPath">
                </div>
                <div class="form-group">
                    <label>å…³è”æ–‡ä»¶æ›´æ–°:</label>
                    <input type="text" placeholder="ä¾‹ï¼šã€Šä½œä¸šæŒ‡å¯¼ä¹¦ã€‹ç‰ˆæœ¬å·V2.0ï¼Œç”Ÿæ•ˆæ—¥æœŸ2025/12/15" id="relatedFilesUpdate">
                </div>
                <div class="form-group">
                    <label>æ–‡ä»¶åˆ†å‘èŒƒå›´:</label>
                    <input type="text" placeholder="ä¾‹ï¼šç”Ÿäº§éƒ¨/å“è´¨éƒ¨/ä¾›åº”é“¾ç­‰" id="fileDistributionScope">
                </div>
                <div class="form-group">
                    <label>æ—§æ–‡ä»¶ä½œåºŸæ—¥æœŸ:</label>
                    <input type="date" id="oldFileObsoleteDate">
                </div>
                <div class="form-group">
                    <label>æ–‡ä»¶åŸ¹è®­è¦æ±‚:</label>
                    <input type="text" placeholder="ä¾‹ï¼šæ–°æ–‡ä»¶å‘å¸ƒå3ä¸ªå·¥ä½œæ—¥å†…å®Œæˆå…¨å‘˜åŸ¹è®­" id="fileTrainingRequirement">
                </div>
            </div>
            
            <div class="subsection">
                <h3 class="subsection-title">é¢„é˜²æœºåˆ¶å¤±æ•ˆé¢„æ¡ˆ</h3>
                <div class="form-group">
                    <textarea placeholder="è‹¥é¢„é˜²æœºåˆ¶å¤±æ•ˆï¼Œå¯åŠ¨çš„åº”æ€¥æªæ–½ï¼ˆä¾‹ï¼šç«‹å³æ¢å¤æ—§ç‰ˆç®¡æ§æµç¨‹ï¼Œ24å°æ—¶å†…ç»„ç»‡åŸå› åˆ†æï¼‰" id="preventionFailurePlan"></textarea>
                </div>
            </div>
        </div>
        
        <!-- ä¹ã€é™„ä»¶æ¸…å• -->
        <div class="section">
            <h2 class="section-title">ä¹ã€é™„ä»¶æ¸…å•</h2>
            
            <table class="improvement-table" id="attachment-table">
                <thead>
                    <tr>
                        <th width="25%">é™„ä»¶åç§°</th>
                        <th width="15%">é™„ä»¶ç‰ˆæœ¬</th>
                        <th width="25%">ä¸Šä¼ è·¯å¾„/å­˜å‚¨ä½ç½®</th>
                        <th width="15%">å­˜å‚¨æœŸé™</th>
                        <th width="20%">å¤‡æ³¨</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td><input type="text" placeholder="å¼‚å¸¸å®ç‰©ç…§ç‰‡" style="width: 100%; border: none;" id="attachmentName_0"></td>
                        <td><input type="text" placeholder="V1.0" style="width: 100%; border: none;" id="attachmentVersion_0"></td>
                        <td><input type="text" placeholder="æœåŠ¡å™¨è·¯å¾„XXX" style="width: 100%; border: none;" id="attachmentPath_0"></td>
                        <td><input type="text" placeholder="3å¹´" style="width: 100%; border: none;" id="attachmentStoragePeriod_0"></td>
                        <td><input type="text" placeholder="å«5å¼ ç‰¹å†™å›¾" style="width: 100%; border: none;" id="attachmentRemark_0"></td>
                    </tr>
                    <tr>
                        <td><input type="text" placeholder="é±¼éª¨å›¾æ–‡ä»¶" style="width: 100%; border: none;" id="attachmentName_1"></td>
                        <td><input type="text" placeholder="V1.0" style="width: 100%; border: none;" id="attachmentVersion_1"></td>
                        <td><input type="text" placeholder="æœåŠ¡å™¨è·¯å¾„XXX" style="width: 100%; border: none;" id="attachmentPath_1"></td>
                        <td><input type="text" placeholder="3å¹´" style="width: 100%; border: none;" id="attachmentStoragePeriod_1"></td>
                        <td><input type="text" placeholder="" style="width: 100%; border: none;" id="attachmentRemark_1"></td>
                    </tr>
                    <tr>
                        <td><input type="text" placeholder="è®¾å¤‡æ£€æµ‹æŠ¥å‘Š" style="width: 100%; border: none;" id="attachmentName_2"></td>
                        <td><input type="text" placeholder="V1.0" style="width: 100%; border: none;" id="attachmentVersion_2"></td>
                        <td><input type="text" placeholder="æœåŠ¡å™¨è·¯å¾„XXX" style="width: 100%; border: none;" id="attachmentPath_2"></td>
                        <td><input type="text" placeholder="3å¹´" style="width: 100%; border: none;" id="attachmentStoragePeriod_2"></td>
                        <td><input type="text" placeholder="" style="width: 100%; border: none;" id="attachmentRemark_2"></td>
                    </tr>
                </tbody>
            </table>
            <button class="add-row-btn" onclick="addAttachmentRow()">+ æ·»åŠ é™„ä»¶</button>
        </div>
        
        <!-- åã€å®¡æ‰¹æµç¨‹ -->
        <div class="section">
            <h2 class="section-title">åã€å®¡æ‰¹æµç¨‹</h2>
            
            <div class="subsection">
                <h3 class="subsection-title">å®¡æ‰¹ä¿¡æ¯</h3>
                <div class="form-group">
                    <div class="form-line">
                        <label>æ±‡æŠ¥äºº:</label>
                        <input type="text" id="reporterName">
                        <label style="min-width: 1cm; margin-left: 0.5cm;">æäº¤æ—¶é—´:</label>
                        <input type="datetime-local" id="submitTime">
                    </div>
                </div>
                
                <table class="improvement-table" id="approval-table">
                    <thead>
                        <tr>
                            <th width="20%">å®¡æ‰¹ç¯èŠ‚</th>
                            <th width="15%">å®¡æ‰¹äºº</th>
                            <th width="15%">å®¡æ‰¹æ—¶é—´</th>
                            <th width="30%">å®¡æ‰¹æ„è§</th>
                            <th width="15%">å®¡æ‰¹çŠ¶æ€</th>
                            <th width="5%"></th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>éƒ¨é—¨è´Ÿè´£äººå®¡æ ¸</td>
                            <td><input type="text" placeholder="å§“å" style="width: 100%; border: none;" id="deptApprover"></td>
                            <td><input type="datetime-local" style="width: 100%; border: none;" id="deptApproveTime"></td>
                            <td><input type="text" placeholder="å®¡æ‰¹æ„è§" style="width: 100%; border: none;" id="deptApproveComment"></td>
                            <td>
                                <select style="width: 100%; border: none;" id="deptApproveStatus">
                                    <option value="">è¯·é€‰æ‹©</option>
                                    <option value="pending">å¾…å®¡æ‰¹</option>
                                    <option value="approved">é€šè¿‡</option>
                                    <option value="rejected">é©³å›</option>
                                </select>
                            </td>
                            <td></td>
                        </tr>
                        <tr>
                            <td>å“è´¨éƒ¨å¤æ ¸</td>
                            <td><input type="text" placeholder="å§“å" style="width: 100%; border: none;" id="qualityApprover"></td>
                            <td><input type="datetime-local" style="width: 100%; border: none;" id="qualityApproveTime"></td>
                            <td><input type="text" placeholder="å¤æ ¸æ„è§" style="width: 100%; border: none;" id="qualityApproveComment"></td>
                            <td>
                                <select style="width: 100%; border: none;" id="qualityApproveStatus">
                                    <option value="">è¯·é€‰æ‹©</option>
                                    <option value="pending">å¾…å¤æ ¸</option>
                                    <option value="approved">é€šè¿‡</option>
                                    <option value="rejected">é©³å›</option>
                                </select>
                            </td>
                            <td></td>
                        </tr>
                        <tr>
                            <td>åˆ†ç®¡é¢†å¯¼å®¡æ‰¹</td>
                            <td><input type="text" placeholder="å§“å" style="width: 100%; border: none;" id="leaderApprover"></td>
                            <td><input type="datetime-local" style="width: 100%; border: none;" id="leaderApproveTime"></td>
                            <td><input type="text" placeholder="å®¡æ‰¹æ„è§" style="width: 100%; border: none;" id="leaderApproveComment"></td>
                            <td>
                                <select style="width: 100%; border: none;" id="leaderApproveStatus">
                                    <option value="">è¯·é€‰æ‹©</option>
                                    <option value="pending">å¾…å®¡æ‰¹</option>
                                    <option value="approved">é€šè¿‡</option>
                                    <option value="rejected">é©³å›</option>
                                </select>
                            </td>
                            <td></td>
                        </tr>
                    </tbody>
                </table>
                
                <div class="guidance-text">
                    <strong>æ ‡å‡†å®¡æ‰¹æ—¶é™ï¼š</strong>
                    <ul>
                        <li>éƒ¨é—¨è´Ÿè´£äººå®¡æ ¸ï¼šâ‰¤1ä¸ªå·¥ä½œæ—¥</li>
                        <li>å“è´¨éƒ¨å¤æ ¸ï¼šâ‰¤1ä¸ªå·¥ä½œæ—¥</li>
                        <li>åˆ†ç®¡é¢†å¯¼å®¡æ‰¹ï¼šâ‰¤1ä¸ªå·¥ä½œæ—¥</li>
                    </ul>
                    <strong>è¶…æ—¶å¤„ç†æ–¹å¼ï¼š</strong>è¶…æ—¶æœªå®¡æ‰¹è‡ªåŠ¨å‡çº§è‡³ä¸Šçº§é¢†å¯¼ï¼ŒåŒæ—¶å‘é€æé†’é‚®ä»¶
                </div>
            </div>
        </div>
        
        <!-- æŠ¥å‘Šå½’æ¡£è¦æ±‚ -->
        <div class="section">
            <h2 class="section-title">æŠ¥å‘Šå½’æ¡£è¦æ±‚</h2>
            
            <div class="subsection">
                <div class="two-column">
                    <div class="column">
                        <div class="form-line">
                            <label>å½’æ¡£éƒ¨é—¨:</label>
                            <input type="text" placeholder="ä¾‹ï¼šå“è´¨éƒ¨æ¡£æ¡ˆå®¤" id="archiveDept">
                        </div>
                        <div class="form-line">
                            <label>å½’æ¡£å½¢å¼:</label>
                            <input type="text" placeholder="ä¾‹ï¼šç”µå­æ¡£+çº¸è´¨æ¡£" id="archiveFormat">
                        </div>
                    </div>
                    <div class="column">
                        <div class="form-line">
                            <label>å½’æ¡£æ—¶é™:</label>
                            <input type="text" placeholder="ä¾‹ï¼šæŠ¥å‘Šé—­ç¯å3ä¸ªå·¥ä½œæ—¥å†…" id="archiveDeadline">
                        </div>
                        <div class="form-line">
                            <label>æ¡£æ¡ˆç¼–å·:</label>
                            <input type="text" placeholder="è‡ªåŠ¨ç”Ÿæˆ" id="archiveNumber">
                        </div>
                    </div>
                </div>
                <div class="form-group">
                    <label>å½’æ¡£è¦æ±‚è¯´æ˜:</label>
                    <textarea placeholder="å…·ä½“å½’æ¡£è¦æ±‚è¯´æ˜..." id="archiveRequirements"></textarea>
                </div>
            </div>
        </div>
        
        <!-- ç‰ˆæœ¬è®°å½• -->
        <div class="section">
            <h2 class="section-title">ç‰ˆæœ¬è®°å½•</h2>
            
            <div class="subsection">
                <table class="improvement-table" id="version-table">
                    <thead>
                        <tr>
                            <th width="15%">ç‰ˆæœ¬å·</th>
                            <th width="15%">æ›´æ–°æ—¥æœŸ</th>
                            <th width="40%">æ›´æ–°å†…å®¹</th>
                            <th width="15%">æ›´æ–°äºº</th>
                            <th width="15%">å®¡æ ¸äºº</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td><input type="text" placeholder="V1.0" style="width: 100%; border: none;" id="versionNumber_0"></td>
                            <td><input type="date" style="width: 100%; border: none;" id="versionDate_0"></td>
                            <td><input type="text" placeholder="åˆå§‹ç‰ˆæœ¬" style="width: 100%; border: none;" id="versionContent_0"></td>
                            <td><input type="text" placeholder="æ›´æ–°äºº" style="width: 100%; border: none;" id="versionUpdater_0"></td>
                            <td><input type="text" placeholder="å®¡æ ¸äºº" style="width: 100%; border: none;" id="versionApprover_0"></td>
                        </tr>
                    </tbody>
                </table>
                <button class="add-row-btn" onclick="addVersionRow()">+ æ·»åŠ ç‰ˆæœ¬è®°å½•</button>
            </div>
        </div>
        
        <!-- æŒ‰é’®åŒºåŸŸ -->
        <div class="btn-group">
            <button class="btn-primary" onclick="window.print()">
                <span>ğŸ–¨ï¸</span> æ‰“å°æŠ¥å‘Š
            </button>
            <button onclick="saveAsPDF()">
                <span>ğŸ“„</span> å¯¼å‡ºPDF
            </button>
            <button class="btn-excel" onclick="openExcelExportModal()">
                <span>ğŸ“Š</span> å¯¼å‡ºåˆ°Excel
            </button>
            <button class="btn-success" onclick="saveReport('auto')">
                <span>ğŸ’¾</span> å¿«é€Ÿä¿å­˜
            </button>
            <button onclick="resetForm()">
                <span>ğŸ”„</span> é‡ç½®è¡¨å•
            </button>
        </div>
    </div>
    
    <!-- ä¿å­˜æŠ¥å‘Šæ¨¡æ€æ¡† -->
    <div class="save-modal" id="saveModal">
        <div class="save-modal-content">
            <div class="modal-header">
                <div class="modal-title">ä¿å­˜æŠ¥å‘Š</div>
                <button class="close-modal" onclick="closeSaveModal()">&times;</button>
            </div>
            
            <div class="save-options">
                <div class="option-group">
                    <label>ä¿å­˜æ–¹å¼:</label>
                    <div class="save-formats">
                        <div class="format-option selected" data-format="local" onclick="selectSaveFormat('local')">
                            <div class="format-icon">ğŸ’¾</div>
                            <div class="format-name">æœ¬åœ°ä¿å­˜</div>
                            <div class="format-desc">ä¿å­˜åˆ°æµè§ˆå™¨æœ¬åœ°å­˜å‚¨</div>
                        </div>
                        <div class="format-option" data-format="file" onclick="selectSaveFormat('file')">
                            <div class="format-icon">ğŸ“</div>
                            <div class="format-name">æ–‡ä»¶ä¿å­˜</div>
                            <div class="format-desc">å¯¼å‡ºä¸ºJSONæ–‡ä»¶</div>
                        </div>
                        <div class="format-option" data-format="cloud" onclick="selectSaveFormat('cloud')">
                            <div class="format-icon">â˜ï¸</div>
                            <div class="format-name">äº‘å­˜å‚¨</div>
                            <div class="format-desc">ä¿å­˜åˆ°äº‘ç«¯æœåŠ¡å™¨</div>
                        </div>
                    </div>
                </div>
                
                <!-- æœ¬åœ°ä¿å­˜é€‰é¡¹ -->
                <div class="option-group" id="localOptions" style="display: block;">
                    <label>æŠ¥å‘Šåç§°:</label>
                    <input type="text" id="reportName" placeholder="è¯·è¾“å…¥æŠ¥å‘Šåç§°" style="width: 100%;" value="">
                    <div class="save-description">æŠ¥å‘Šå°†ä¿å­˜åˆ°æµè§ˆå™¨çš„æœ¬åœ°å­˜å‚¨ä¸­ï¼Œä»…å½“å‰æµè§ˆå™¨å¯ç”¨</div>
                </div>
                
                <!-- æ–‡ä»¶ä¿å­˜é€‰é¡¹ -->
                <div class="option-group" id="fileOptions" style="display: none;">
                    <label>æ–‡ä»¶åç§°:</label>
                    <input type="text" id="fileName" placeholder="è¯·è¾“å…¥æ–‡ä»¶å" style="width: 100%;" value="äº§å“å¼‚å¸¸åˆ†ææŠ¥å‘Š.json">
                    <div class="save-description">æŠ¥å‘Šå°†å¯¼å‡ºä¸ºJSONæ–‡ä»¶ï¼Œå¯ç”¨äºå¤‡ä»½å’Œåˆ†äº«</div>
                </div>
                
                <!-- äº‘å­˜å‚¨é€‰é¡¹ -->
                <div class="option-group" id="cloudOptions" style="display: none;">
                    <label>æœåŠ¡å™¨åœ°å€:</label>
                    <input type="text" id="serverUrl" placeholder="https://api.example.com/save" style="width: 100%;" value="">
                    <div class="save-description">éœ€è¦é…ç½®æœåŠ¡å™¨APIæ¥å£åœ°å€</div>
                    <div class="checkbox-item">
                        <input type="checkbox" id="encryptData">
                        <label for="encryptData">åŠ å¯†ä¼ è¾“æ•°æ®</label>
                    </div>
                </div>
                
                <div class="option-group">
                    <label>ä¿å­˜é€‰é¡¹:</label>
                    <div class="checkbox-group">
                        <div class="checkbox-item">
                            <input type="checkbox" id="includeImages" checked>
                            <label for="includeImages">åŒ…å«å›¾ç‰‡æ•°æ®</label>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" id="compressData" checked>
                            <label for="compressData">å‹ç¼©æ•°æ®</label>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" id="createBackup">
                            <label for="createBackup">åˆ›å»ºå¤‡ä»½</label>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="progress-bar" id="saveProgressBar">
                <div class="progress-fill" id="saveProgressFill"></div>
            </div>
            <div class="progress-text" id="saveProgressText">å‡†å¤‡ä¿å­˜...</div>
            
            <div class="save-status" id="saveStatus"></div>
            
            <div class="btn-group">
                <button class="btn-success" onclick="saveReport('manual')">
                    <span>ğŸ’¾</span> ç¡®è®¤ä¿å­˜
                </button>
                <button onclick="closeSaveModal()">å–æ¶ˆ</button>
            </div>
        </div>
    </div>
    
    <!-- åŠ è½½æŠ¥å‘Šæ¨¡æ€æ¡† -->
    <div class="save-modal" id="loadModal">
        <div class="save-modal-content load-modal-content">
            <div class="modal-header">
                <div class="modal-title">åŠ è½½æŠ¥å‘Š</div>
                <button class="close-modal" onclick="closeLoadModal()">&times;</button>
            </div>
            
            <div class="option-group">
                <label>åŠ è½½æ¥æº:</label>
                <div class="radio-group">
                    <div class="radio-item">
                        <input type="radio" id="load-local" name="load-source" value="local" checked onchange="changeLoadSource('local')">
                        <label for="load-local">æœ¬åœ°å­˜å‚¨</label>
                    </div>
                    <div class="radio-item">
                        <input type="radio" id="load-file" name="load-source" value="file" onchange="changeLoadSource('file')">
                        <label for="load-file">æ–‡ä»¶å¯¼å…¥</label>
                    </div>
                    <div class="radio-item">
                        <input type="radio" id="load-cloud" name="load-source" value="cloud" onchange="changeLoadSource('cloud')">
                        <label for="load-cloud">äº‘å­˜å‚¨</label>
                    </div>
                </div>
            </div>
            
            <!-- æœ¬åœ°æŠ¥å‘Šåˆ—è¡¨ -->
            <div id="localReports" style="display: block;">
                <h3>å·²ä¿å­˜çš„æŠ¥å‘Š</h3>
                <div class="saved-reports-list" id="savedReportsList">
                    <!-- æŠ¥å‘Šåˆ—è¡¨å°†é€šè¿‡JSåŠ¨æ€ç”Ÿæˆ -->
                </div>
                <div class="btn-group">
                    <button onclick="refreshReportList()">åˆ·æ–°åˆ—è¡¨</button>
                    <button onclick="clearAllReports()" style="background: #f8d7da; border-color: #dc3545; color: #dc3545;">æ¸…ç©ºæ‰€æœ‰æŠ¥å‘Š</button>
                </div>
            </div>
            
            <!-- æ–‡ä»¶å¯¼å…¥ -->
            <div id="fileImport" style="display: none;">
                <div class="option-group">
                    <label>é€‰æ‹©æ–‡ä»¶:</label>
                    <input type="file" id="reportFile" accept=".json,.txt" style="width: 100%; padding: 0.5cm;">
                    <div class="save-description">æ”¯æŒJSONæ ¼å¼çš„æŠ¥å‘Šæ–‡ä»¶</div>
                </div>
                <div class="btn-group">
                    <button onclick="loadFromFile()">å¯¼å…¥æ–‡ä»¶</button>
                </div>
            </div>
            
            <!-- äº‘å­˜å‚¨ -->
            <div id="cloudLoad" style="display: none;">
                <div class="option-group">
                    <label>æœåŠ¡å™¨åœ°å€:</label>
                    <input type="text" id="cloudServerUrl" placeholder="https://api.example.com/load" style="width: 100%;" value="">
                </div>
                <div class="option-group">
                    <label>æŠ¥å‘ŠIDæˆ–åç§°:</label>
                    <input type="text" id="cloudReportId" placeholder="è¯·è¾“å…¥æŠ¥å‘ŠIDæˆ–åç§°" style="width: 100%;">
                </div>
                <div class="btn-group">
                    <button onclick="loadFromCloud()">ä»äº‘ç«¯åŠ è½½</button>
                </div>
            </div>
            
            <div class="save-status" id="loadStatus"></div>
        </div>
    </div>

    <script>
        // ==================== å…¨å±€å˜é‡ ====================
        let currentReportId = null;
        let hasUnsavedChanges = false;
        let autoSaveTimer = null;
        let lastSaveTime = null;
        let selectedSaveFormat = 'local';
        
        // ==================== åˆå§‹åŒ–å‡½æ•° ====================
        
        // é¡µé¢åŠ è½½æ—¶åˆå§‹åŒ–
        window.onload = function() {
            // è®¾ç½®é»˜è®¤æ—¥æœŸæ—¶é—´
            const now = new Date();
            const formattedDate = now.toISOString().slice(0, 16);
            const dateOnly = now.toISOString().slice(0, 10);
            
            document.querySelectorAll('input[type="datetime-local"]').forEach(input => {
                if (!input.value) input.value = formattedDate;
            });
            
            document.getElementById('reportDate').value = dateOnly;
            
            // ç”ŸæˆæŠ¥å‘Šç¼–å·
            generateReportNumber();
            
            // åˆå§‹åŒ–ä¿å­˜æ—¶é—´æ˜¾ç¤º
            updateLastSavedTime();
            
            // æ¢å¤ä¸Šæ¬¡ç¼–è¾‘çš„å†…å®¹ï¼ˆå¦‚æœæœ‰ï¼‰
            restoreLastSession();
            
            // è®¾ç½®è‡ªåŠ¨ä¿å­˜
            setupAutoSave();
            
            // è®¾ç½®è¾“å…¥å˜åŒ–ç›‘å¬
            setupChangeListeners();
            
            // åŠ è½½æœ¬åœ°ä¿å­˜çš„æŠ¥å‘Šåˆ—è¡¨
            refreshReportList();
        };
        
        // ç”ŸæˆæŠ¥å‘Šç¼–å·
        function generateReportNumber() {
            const now = new Date();
            const year = now.getFullYear();
            const month = String(now.getMonth() + 1).padStart(2, '0');
            const day = String(now.getDate()).padStart(2, '0');
            const random = Math.floor(Math.random() * 1000).toString().padStart(3, '0');
            const reportNumber = `AR-${year}${month}${day}-${random}`;
            document.getElementById('reportNumber').value = reportNumber;
        }
        
        // æ¢å¤ä¸Šæ¬¡ä¼šè¯
        function restoreLastSession() {
            const lastSession = localStorage.getItem('lastReportSession');
            if (lastSession) {
                try {
                    const sessionData = JSON.parse(lastSession);
                    if (confirm('æ£€æµ‹åˆ°ä¸Šæ¬¡æœªä¿å­˜çš„ç¼–è¾‘å†…å®¹ï¼Œæ˜¯å¦æ¢å¤ï¼Ÿ')) {
                        loadReportData(sessionData);
                        showSaveIndicator('å·²æ¢å¤ä¸Šæ¬¡ç¼–è¾‘å†…å®¹', 'success');
                    }
                } catch (e) {
                    console.error('æ¢å¤ä¼šè¯å¤±è´¥:', e);
                }
            }
        }
        
        // è®¾ç½®è‡ªåŠ¨ä¿å­˜
        function setupAutoSave() {
            // æ¯30ç§’æ£€æŸ¥ä¸€æ¬¡æ˜¯å¦éœ€è¦è‡ªåŠ¨ä¿å­˜
            autoSaveTimer = setInterval(() => {
                if (hasUnsavedChanges) {
                    autoSave();
                }
            }, 30000);
            
            // é¡µé¢ç¦»å¼€æ—¶ä¿å­˜
            window.addEventListener('beforeunload', function(e) {
                if (hasUnsavedChanges) {
                    saveToSession();
                    e.preventDefault();
                    e.returnValue = 'æ‚¨æœ‰æœªä¿å­˜çš„æ›´æ”¹ï¼Œç¡®å®šè¦ç¦»å¼€å—ï¼Ÿ';
                }
            });
        }
        
        // è®¾ç½®è¾“å…¥å˜åŒ–ç›‘å¬
        function setupChangeListeners() {
            // ç›‘å¬æ‰€æœ‰è¾“å…¥å…ƒç´ çš„å˜åŒ–
            document.querySelectorAll('input, textarea, select').forEach(element => {
                element.addEventListener('input', markAsChanged);
                element.addEventListener('change', markAsChanged);
            });
            
            // ç›‘å¬å›¾ç‰‡å˜åŒ–
            document.getElementById('anomaly-image-upload').addEventListener('change', markAsChanged);
        }
        
        // æ ‡è®°ä¸ºæœ‰æ›´æ”¹
        function markAsChanged() {
            if (!hasUnsavedChanges) {
                hasUnsavedChanges = true;
                updateReportStatus();
            }
        }
        
        // æ›´æ–°æŠ¥å‘ŠçŠ¶æ€
        function updateReportStatus() {
            const statusElement = document.getElementById('reportStatus');
            if (hasUnsavedChanges) {
                statusElement.textContent = 'æœªä¿å­˜';
                statusElement.className = 'unsaved-changes';
            } else {
                statusElement.textContent = 'å·²ä¿å­˜';
                statusElement.className = '';
            }
        }
        
        // æ›´æ–°æœ€åä¿å­˜æ—¶é—´æ˜¾ç¤º
        function updateLastSavedTime() {
            const lastSavedElement = document.getElementById('lastSaved');
            if (lastSaveTime) {
                const timeAgo = getTimeAgo(lastSaveTime);
                lastSavedElement.textContent = `ä¸Šæ¬¡ä¿å­˜: ${timeAgo}`;
            } else {
                lastSavedElement.textContent = 'ä¸Šæ¬¡ä¿å­˜: ä»æœªä¿å­˜';
            }
        }
        
        // è·å–ç›¸å¯¹æ—¶é—´
        function getTimeAgo(timestamp) {
            const now = new Date();
            const diff = now - new Date(timestamp);
            const minutes = Math.floor(diff / 60000);
            
            if (minutes < 1) return 'åˆšåˆš';
            if (minutes < 60) return `${minutes}åˆ†é’Ÿå‰`;
            
            const hours = Math.floor(minutes / 60);
            if (hours < 24) return `${hours}å°æ—¶å‰`;
            
            const days = Math.floor(hours / 24);
            return `${days}å¤©å‰`;
        }
        
        // ==================== è¡¨æ ¼åŠ è½½ä¸“ç”¨å‡½æ•° ====================
        
        // åŠ è½½å¼‚å¸¸å¤„ç†è¡¨æ ¼
        function loadTreatmentTable(rows) {
            const table = document.getElementById('treatment-table');
            const tbody = table.querySelector('tbody');
            
            // æ¸…ç©ºç°æœ‰è¡Œï¼ˆé™¤äº†ç¬¬ä¸€è¡Œæ¨¡æ¿ï¼‰
            while (tbody.children.length > 1) {
                tbody.removeChild(tbody.lastChild);
            }
            
            // ä»ç¬¬äºŒè¡Œå¼€å§‹åŠ è½½æ•°æ®ï¼ˆç¬¬ä¸€è¡Œæ˜¯æ¨¡æ¿ï¼‰
            rows.forEach((rowData, index) => {
                if (index === 0) {
                    // ç¬¬ä¸€è¡Œç”¨ç°æœ‰è¡Œå¡«å……
                    const firstRow = tbody.querySelector('tr');
                    if (firstRow) {
                        fillRowInputs(firstRow, rowData);
                    }
                } else {
                    // æ·»åŠ æ–°è¡Œå¹¶å¡«å……æ•°æ®
                    addTreatmentRow();
                    const newRow = tbody.lastChild;
                    fillRowInputs(newRow, rowData);
                }
            });
        }
        
        // åŠ è½½æ”¹å–„æªæ–½è¡¨æ ¼ï¼ˆé€šç”¨å‡½æ•°ï¼‰
        function loadMeasureTable(tableId, rows, prefix) {
            const table = document.getElementById(tableId);
            const tbody = table.querySelector('tbody');
            
            // æ¸…ç©ºç°æœ‰è¡Œï¼ˆé™¤äº†ç¬¬ä¸€è¡Œæ¨¡æ¿ï¼‰
            while (tbody.children.length > 1) {
                tbody.removeChild(tbody.lastChild);
            }
            
            // åŠ è½½æ•°æ®
            rows.forEach((rowData, index) => {
                if (index === 0) {
                    // ç¬¬ä¸€è¡Œç”¨ç°æœ‰è¡Œå¡«å……
                    const firstRow = tbody.querySelector('tr');
                    if (firstRow) {
                        fillRowInputs(firstRow, rowData, prefix);
                    }
                } else {
                    // æ·»åŠ æ–°è¡Œå¹¶å¡«å……æ•°æ®
                    if (tableId === 'temporary-measures-table') {
                        addRow('temporary-measures-table');
                    } else {
                        addRow('long-term-measures-table');
                    }
                    const newRow = tbody.lastChild;
                    fillRowInputs(newRow, rowData, prefix);
                }
            });
        }
        
        // åŠ è½½èµ„æºéœ€æ±‚è¡¨æ ¼
        function loadResourceTable(rows) {
            const table = document.getElementById('resource-table');
            const tbody = table.querySelector('tbody');
            
            // æ¸…ç©ºç°æœ‰è¡Œï¼ˆé™¤äº†ç¬¬ä¸€è¡Œæ¨¡æ¿ï¼‰
            while (tbody.children.length > 1) {
                tbody.removeChild(tbody.lastChild);
            }
            
            // åŠ è½½æ•°æ®
            rows.forEach((rowData, index) => {
                if (index === 0) {
                    // ç¬¬ä¸€è¡Œç”¨ç°æœ‰è¡Œå¡«å……
                    const firstRow = tbody.querySelector('tr');
                    if (firstRow) {
                        fillRowInputs(firstRow, rowData);
                    }
                } else {
                    // æ·»åŠ æ–°è¡Œå¹¶å¡«å……æ•°æ®
                    addResourceRow();
                    const newRow = tbody.lastChild;
                    fillRowInputs(newRow, rowData);
                }
            });
        }
        
        // åŠ è½½é£é™©é¢„åˆ¤è¡¨æ ¼
        function loadRiskTable(rows) {
            const table = document.getElementById('risk-table');
            const tbody = table.querySelector('tbody');
            
            // æ¸…ç©ºç°æœ‰è¡Œï¼ˆé™¤äº†ç¬¬ä¸€è¡Œæ¨¡æ¿ï¼‰
            while (tbody.children.length > 1) {
                tbody.removeChild(tbody.lastChild);
            }
            
            // åŠ è½½æ•°æ®
            rows.forEach((rowData, index) => {
                if (index === 0) {
                    // ç¬¬ä¸€è¡Œç”¨ç°æœ‰è¡Œå¡«å……
                    const firstRow = tbody.querySelector('tr');
                    if (firstRow) {
                        fillRowInputs(firstRow, rowData);
                    }
                } else {
                    // æ·»åŠ æ–°è¡Œå¹¶å¡«å……æ•°æ®
                    addRiskRow();
                    const newRow = tbody.lastChild;
                    fillRowInputs(newRow, rowData);
                }
            });
        }
        
        // åŠ è½½é™„ä»¶æ¸…å•è¡¨æ ¼
        function loadAttachmentTable(rows) {
            const table = document.getElementById('attachment-table');
            const tbody = table.querySelector('tbody');
            
            // æ¸…ç©ºç°æœ‰è¡Œï¼ˆé™¤äº†ç¬¬ä¸€è¡Œæ¨¡æ¿ï¼‰
            while (tbody.children.length > rows.length) {
                tbody.removeChild(tbody.lastChild);
            }
            
            // ç¡®ä¿æœ‰è¶³å¤Ÿçš„è¡Œ
            while (tbody.children.length < rows.length) {
                addAttachmentRow();
            }
            
            // åŠ è½½æ•°æ®
            rows.forEach((rowData, index) => {
                const row = tbody.children[index];
                if (row) {
                    fillRowInputs(row, rowData);
                }
            });
        }
        
        // åŠ è½½ç‰ˆæœ¬è®°å½•è¡¨æ ¼
        function loadVersionTable(rows) {
            const table = document.getElementById('version-table');
            const tbody = table.querySelector('tbody');
            
            // æ¸…ç©ºç°æœ‰è¡Œï¼ˆé™¤äº†ç¬¬ä¸€è¡Œæ¨¡æ¿ï¼‰
            while (tbody.children.length > rows.length) {
                tbody.removeChild(tbody.lastChild);
            }
            
            // ç¡®ä¿æœ‰è¶³å¤Ÿçš„è¡Œ
            while (tbody.children.length < rows.length) {
                addVersionRow();
            }
            
            // åŠ è½½æ•°æ®
            rows.forEach((rowData, index) => {
                const row = tbody.children[index];
                if (row) {
                    fillRowInputs(row, rowData);
                }
            });
        }
        
        // åŠ è½½å®¡æ‰¹æµç¨‹è¡¨æ ¼
        function loadApprovalTable(rows) {
            // å®¡æ‰¹è¡¨æ ¼åªæœ‰3è¡Œå›ºå®šæ•°æ®ï¼Œç›´æ¥å¡«å……
            rows.forEach((rowData, index) => {
                // éå†è¡Œæ•°æ®ä¸­çš„æ¯ä¸ªé”®å€¼å¯¹
                for (const [key, value] of Object.entries(rowData)) {
                    const element = document.getElementById(key);
                    if (element) {
                        if (element.tagName === 'SELECT') {
                            element.value = value.value || value;
                        } else {
                            element.value = value;
                        }
                    }
                }
            });
        }
        
        // é€šç”¨å‡½æ•°ï¼šå¡«å……è¡Œä¸­çš„è¾“å…¥æ¡†
        function fillRowInputs(row, rowData, prefix = '') {
            const inputs = row.querySelectorAll('input, select');
            inputs.forEach(input => {
                // è·å–è¾“å…¥æ¡†çš„åŸå§‹ID
                const originalId = input.id;
                
                // å°è¯•ä»rowDataä¸­è·å–å€¼
                let value = null;
                
                // å°è¯•å¤šç§å¯èƒ½çš„é”®åæ ¼å¼
                if (rowData[originalId] !== undefined) {
                    value = rowData[originalId];
                } else {
                    // éå†rowDataçš„æ‰€æœ‰é”®ï¼Œå°è¯•åŒ¹é…
                    for (const key in rowData) {
                        if (key.includes(originalId.split('_')[0])) {
                            value = rowData[key];
                            break;
                        }
                    }
                }
                
                // è®¾ç½®å€¼
                if (value !== null && value !== undefined) {
                    if (input.tagName === 'SELECT') {
                        // å¯¹äºä¸‹æ‹‰èœå•ï¼Œè®¾ç½®é€‰ä¸­çš„option
                        if (typeof value === 'object' && value.value !== undefined) {
                            input.value = value.value;
                        } else {
                            input.value = value;
                        }
                    } else {
                        input.value = value;
                    }
                }
            });
        }
        
        // ==================== ä¿å­˜åŠŸèƒ½ ====================
        
        // æ‰“å¼€ä¿å­˜æ¨¡æ€æ¡†
        function openSaveModal() {
            document.getElementById('saveModal').style.display = 'flex';
            
            // è®¾ç½®é»˜è®¤æŠ¥å‘Šåç§°
            const reportNumber = document.getElementById('reportNumber').value;
            const productName = document.getElementById('productName').value;
            const anomalyProblem = document.getElementById('anomalyProblem').value;
            
            let defaultName = reportNumber;
            if (productName) defaultName += `_${productName}`;
            if (anomalyProblem) defaultName += `_${anomalyProblem.substring(0, 20)}`;
            
            document.getElementById('reportName').value = defaultName;
            document.getElementById('fileName').value = `${defaultName}.json`;
        }
        
        // å…³é—­ä¿å­˜æ¨¡æ€æ¡†
        function closeSaveModal() {
            document.getElementById('saveModal').style.display = 'none';
            resetSaveUI();
        }
        
        // é€‰æ‹©ä¿å­˜æ ¼å¼
        function selectSaveFormat(format) {
            selectedSaveFormat = format;
            
            // æ›´æ–°UI
            document.querySelectorAll('.format-option').forEach(el => {
                el.classList.remove('selected');
            });
            document.querySelector(`.format-option[data-format="${format}"]`).classList.add('selected');
            
            // æ˜¾ç¤ºå¯¹åº”çš„é€‰é¡¹
            document.getElementById('localOptions').style.display = 'none';
            document.getElementById('fileOptions').style.display = 'none';
            document.getElementById('cloudOptions').style.display = 'none';
            document.getElementById(`${format}Options`).style.display = 'block';
        }
        
        // ä¿å­˜æŠ¥å‘Š
        function saveReport(mode) {
            if (mode === 'auto') {
                quickSave();
            } else {
                manualSave();
            }
        }
        
        // å¿«é€Ÿä¿å­˜
        function quickSave() {
            const reportName = document.getElementById('productName').value || 
                              document.getElementById('reportNumber').value || 
                              'æœªå‘½åæŠ¥å‘Š';
            
            saveToLocalStorage(reportName);
        }
        
        // æ‰‹åŠ¨ä¿å­˜
        function manualSave() {
            resetSaveUI();
            
            // æ˜¾ç¤ºè¿›åº¦æ¡
            document.getElementById('saveProgressBar').style.display = 'block';
            document.getElementById('saveProgressText').style.display = 'block';
            updateSaveProgress(10, 'æ”¶é›†æŠ¥å‘Šæ•°æ®...');
            
            // æ”¶é›†æ•°æ®
            const reportData = collectReportData();
            updateSaveProgress(30, 'å¤„ç†æ•°æ®...');
            
            // æ ¹æ®é€‰æ‹©çš„æ ¼å¼ä¿å­˜
            switch (selectedSaveFormat) {
                case 'local':
                    saveToLocalStorage(reportData);
                    break;
                case 'file':
                    saveToFile(reportData);
                    break;
                case 'cloud':
                    saveToCloud(reportData);
                    break;
            }
        }
        
        // æ”¶é›†æŠ¥å‘Šæ•°æ®
        function collectReportData() {
            const data = {
                metadata: {
                    id: currentReportId || generateId(),
                    name: document.getElementById('reportName').value,
                    number: document.getElementById('reportNumber').value,
                    date: document.getElementById('reportDate').value,
                    state: document.getElementById('reportState').value,
                    createdAt: new Date().toISOString(),
                    updatedAt: new Date().toISOString(),
                    version: '1.0'
                },
                basicInfo: collectSectionData('basic'),
                description: collectSectionData('description'),
                impact: collectSectionData('impact'),
                treatment: collectSectionData('treatment'),
                rootCause: collectSectionData('rootCause'),
                improvement: collectSectionData('improvement'),
                validation: collectSectionData('validation'),
                prevention: collectSectionData('prevention'),
                attachments: collectSectionData('attachments'),
                approval: collectSectionData('approval'),
                archive: collectSectionData('archive'),
                versions: collectSectionData('versions'),
                tables: collectTableData(),
                images: collectImagesData()
            };
            
            return data;
        }
        
        // æ”¶é›†ç« èŠ‚æ•°æ®
        function collectSectionData(section) {
            const data = {};
            
            switch (section) {
                case 'basic':
                    data.productCode = document.getElementById('productCode').value;
                    data.productName = document.getElementById('productName').value;
                    data.batchNumber = document.getElementById('batchNumber').value;
                    data.orderNumber = document.getElementById('orderNumber').value;
                    data.anomalyLevel = document.getElementById('anomalyLevel').value;
                    data.responsePerson = document.getElementById('responsePerson').value;
                    data.responsibleDept = document.getElementById('responsibleDept').value;
                    data.cooperateDepts = document.getElementById('cooperateDepts').value;
                    data.anomalyProblem = document.getElementById('anomalyProblem').value;
                    data.productionLine = document.getElementById('productionLine').value;
                    break;
                    
                case 'description':
                    data.quantitativeDesc = document.getElementById('quantitativeDesc').value;
                    data.phenomenonCompare = document.getElementById('phenomenonCompare').value;
                    data.detectionStandard = document.getElementById('detectionStandard').value;
                    data.locationLevel = document.getElementById('locationLevel').value;
                    data.locationDetail = document.getElementById('locationDetail').value;
                    data.discoverer = document.getElementById('discoverer').value;
                    data.discoveryStage = document.getElementById('discoveryStage').value;
                    data.discoveryTime = document.getElementById('discoveryTime').value;
                    data.firstFeedbackTime = document.getElementById('firstFeedbackTime').value;
                    data.clientScenario = document.getElementById('clientScenario').value;
                    data.imageDescription = document.getElementById('imageDescription').value;
                    data.photographer = document.getElementById('photographer').value;
                    data.cameraDevice = document.getElementById('cameraDevice').value;
                    break;
                    
                case 'impact':
                    data.affectedMaterial = document.getElementById('affectedMaterial').value;
                    data.affectedQuantity = document.getElementById('affectedQuantity').value;
                    data.defectRate = document.getElementById('defectRate').value;
                    data.isolationStatus = document.getElementById('isolationStatus').value;
                    data.isolationLocation = document.getElementById('isolationLocation').value;
                    data.productRiskLevel = document.getElementById('productRiskLevel').value;
                    data.supplyChannel = document.getElementById('supplyChannel').value;
                    data.channelType = document.getElementById('channelType').value;
                    data.orderStatus = document.getElementById('orderStatus').value;
                    data.supplyQuantity = document.getElementById('supplyQuantity').value;
                    data.plannedDeliveryDate = document.getElementById('plannedDeliveryDate').value;
                    data.affectsDelivery = document.getElementById('affectsDelivery').value;
                    data.delayDays = document.getElementById('delayDays').value;
                    data.emergencyPlan = document.getElementById('emergencyPlan').value;
                    data.reworkCost = document.getElementById('reworkCost').value;
                    data.scrapCost = document.getElementById('scrapCost').value;
                    data.urgentShippingCost = document.getElementById('urgentShippingCost').value;
                    data.customerClaimCost = document.getElementById('customerClaimCost').value;
                    data.otherCost = document.getElementById('otherCost').value;
                    data.totalCost = document.getElementById('totalCost').value;
                    data.costCalculationBasis = document.getElementById('costCalculationBasis').value;
                    data.complaintRiskLevel = document.getElementById('complaintRiskLevel').value;
                    data.customerType = document.getElementById('customerType').value;
                    data.complaintResponseTime = document.getElementById('complaintResponseTime').value;
                    data.complaintAssessmentBasis = document.getElementById('complaintAssessmentBasis').value;
                    break;
                    
                case 'treatment':
                    data.spreadControlMeasures = document.getElementById('spreadControlMeasures').value;
                    data.treatmentObstacles = document.getElementById('treatmentObstacles').value;
                    break;
                    
                case 'rootCause':
                    data.humanFactors = document.getElementById('humanFactors').value;
                    data.humanVerified = document.getElementById('humanVerified').value;
                    data.humanVerificationBasis = document.getElementById('humanVerificationBasis').value;
                    data.humanVerifier = document.getElementById('humanVerifier').value;
                    data.equipmentFactors = document.getElementById('equipmentFactors').value;
                    data.equipmentVerified = document.getElementById('equipmentVerified').value;
                    data.equipmentVerificationBasis = document.getElementById('equipmentVerificationBasis').value;
                    data.equipmentVerifier = document.getElementById('equipmentVerifier').value;
                    data.materialFactors = document.getElementById('materialFactors').value;
                    data.materialVerified = document.getElementById('materialVerified').value;
                    data.materialVerificationBasis = document.getElementById('materialVerificationBasis').value;
                    data.materialVerifier = document.getElementById('materialVerifier').value;
                    data.methodFactors = document.getElementById('methodFactors').value;
                    data.methodVerified = document.getElementById('methodVerified').value;
                    data.methodVerificationBasis = document.getElementById('methodVerificationBasis').value;
                    data.methodVerifier = document.getElementById('methodVerifier').value;
                    data.environmentFactors = document.getElementById('environmentFactors').value;
                    data.environmentVerified = document.getElementById('environmentVerified').value;
                    data.environmentVerificationBasis = document.getElementById('environmentVerificationBasis').value;
                    data.environmentVerifier = document.getElementById('environmentVerifier').value;
                    data.measurementFactors = document.getElementById('measurementFactors').value;
                    data.measurementVerified = document.getElementById('measurementVerified').value;
                    data.measurementVerificationBasis = document.getElementById('measurementVerificationBasis').value;
                    data.measurementVerifier = document.getElementById('measurementVerifier').value;
                    data.excludedFactors = document.getElementById('excludedFactors').value;
                    data.mainCauseDescription = document.getElementById('mainCauseDescription').value;
                    data.fiveWhyMainCause = document.getElementById('fiveWhyMainCause').value;
                    data.why1 = document.getElementById('why1').value;
                    data.why1Verification = document.getElementById('why1Verification').value;
                    data.why1Closed = document.getElementById('why1Closed').value;
                    data.why1FollowUp = document.getElementById('why1FollowUp').value;
                    data.why1CorrectiveAction = document.getElementById('why1CorrectiveAction').value;
                    data.why2 = document.getElementById('why2').value;
                    data.why2Verification = document.getElementById('why2Verification').value;
                    data.why2Closed = document.getElementById('why2Closed').value;
                    data.why2FollowUp = document.getElementById('why2FollowUp').value;
                    data.why2CorrectiveAction = document.getElementById('why2CorrectiveAction').value;
                    data.why3 = document.getElementById('why3').value;
                    data.why3Verification = document.getElementById('why3Verification').value;
                    data.why3Closed = document.getElementById('why3Closed').value;
                    data.why3FollowUp = document.getElementById('why3FollowUp').value;
                    data.why3CorrectiveAction = document.getElementById('why3CorrectiveAction').value;
                    data.why4 = document.getElementById('why4').value;
                    data.why4Verification = document.getElementById('why4Verification').value;
                    data.why4Closed = document.getElementById('why4Closed').value;
                    data.why4FollowUp = document.getElementById('why4FollowUp').value;
                    data.why4CorrectiveAction = document.getElementById('why4CorrectiveAction').value;
                    data.why5 = document.getElementById('why5').value;
                    data.why5Verification = document.getElementById('why5Verification').value;
                    data.why5Closed = document.getElementById('why5Closed').value;
                    data.rootCauseVerificationResult = document.getElementById('rootCauseVerificationResult').value;
                    data.verificationType = document.getElementById('verificationType').value;
                    data.verificationSampleSize = document.getElementById('verificationSampleSize').value;
                    break;
                    
                case 'improvement':
                    data.effectivenessEvaluationPeriod = document.getElementById('effectivenessEvaluationPeriod').value;
                    break;
                    
                case 'validation':
                    data.improvementEvidence = document.getElementById('improvementEvidence').value;
                    data.improvementComparison = document.getElementById('improvementComparison').value;
                    data.dataCollectionConditions = document.getElementById('dataCollectionConditions').value;
                    data.verificationPerson = document.getElementById('verificationPerson').value;
                    data.verificationDate = document.getElementById('verificationDate').value;
                    data.recurrenceRate = document.getElementById('recurrenceRate').value;
                    data.feedbackPeriod = document.getElementById('feedbackPeriod').value;
                    data.complaintRate = document.getElementById('complaintRate').value;
                    data.returnRate = document.getElementById('returnRate').value;
                    data.complaintCount = document.getElementById('complaintCount').value;
                    data.satisfactionRate = document.getElementById('satisfactionRate').value;
                    data.complaintDetails = document.getElementById('complaintDetails').value;
                    data.customerConfirmation = document.getElementById('customerConfirmation').value;
                    data.noComplaintRequirement = document.getElementById('noComplaintRequirement').value;
                    break;
                    
                case 'prevention':
                    data.processOptimization = document.getElementById('processOptimization').value;
                    data.trainingStrengthening = document.getElementById('trainingStrengthening').value;
                    data.monitoringUpgrade = document.getElementById('monitoringUpgrade').value;
                    data.supplierOptimization = document.getElementById('supplierOptimization').value;
                    data.preventionPerson = document.getElementById('preventionPerson').value;
                    data.preventionDeadline = document.getElementById('preventionDeadline').value;
                    data.regularVerificationPeriod = document.getElementById('regularVerificationPeriod').value;
                    data.verificationMethod = document.getElementById('verificationMethod').value;
                    data.verificationResponsiblePerson = document.getElementById('verificationResponsiblePerson').value;
                    data.verificationReportPath = document.getElementById('verificationReportPath').value;
                    data.relatedFilesUpdate = document.getElementById('relatedFilesUpdate').value;
                    data.fileDistributionScope = document.getElementById('fileDistributionScope').value;
                    data.oldFileObsoleteDate = document.getElementById('oldFileObsoleteDate').value;
                    data.fileTrainingRequirement = document.getElementById('fileTrainingRequirement').value;
                    data.preventionFailurePlan = document.getElementById('preventionFailurePlan').value;
                    break;
                    
                case 'attachments':
                    // é™„ä»¶è¡¨æ ¼æ•°æ®å•ç‹¬å¤„ç†
                    break;
                    
                case 'approval':
                    data.reporterName = document.getElementById('reporterName').value;
                    data.submitTime = document.getElementById('submitTime').value;
                    data.deptApprover = document.getElementById('deptApprover').value;
                    data.deptApproveTime = document.getElementById('deptApproveTime').value;
                    data.deptApproveComment = document.getElementById('deptApproveComment').value;
                    data.deptApproveStatus = document.getElementById('deptApproveStatus').value;
                    data.qualityApprover = document.getElementById('qualityApprover').value;
                    data.qualityApproveTime = document.getElementById('qualityApproveTime').value;
                    data.qualityApproveComment = document.getElementById('qualityApproveComment').value;
                    data.qualityApproveStatus = document.getElementById('qualityApproveStatus').value;
                    data.leaderApprover = document.getElementById('leaderApprover').value;
                    data.leaderApproveTime = document.getElementById('leaderApproveTime').value;
                    data.leaderApproveComment = document.getElementById('leaderApproveComment').value;
                    data.leaderApproveStatus = document.getElementById('leaderApproveStatus').value;
                    break;
                    
                case 'archive':
                    data.archiveDept = document.getElementById('archiveDept').value;
                    data.archiveFormat = document.getElementById('archiveFormat').value;
                    data.archiveDeadline = document.getElementById('archiveDeadline').value;
                    data.archiveNumber = document.getElementById('archiveNumber').value;
                    data.archiveRequirements = document.getElementById('archiveRequirements').value;
                    break;
                    
                case 'versions':
                    // ç‰ˆæœ¬è¡¨æ ¼æ•°æ®å•ç‹¬å¤„ç†
                    break;
            }
            
            return data;
        }
        
        // æ”¶é›†è¡¨æ ¼æ•°æ®
        function collectTableData() {
            const tables = {
                treatment: collectTableRows('treatment-table'),
                temporaryMeasures: collectTableRows('temporary-measures-table'),
                longTermMeasures: collectTableRows('long-term-measures-table'),
                resources: collectTableRows('resource-table'),
                risks: collectTableRows('risk-table'),
                attachments: collectTableRows('attachment-table'),
                approval: collectTableRows('approval-table'),
                versions: collectTableRows('version-table')
            };
            
            return tables;
        }
        
        // æ”¶é›†è¡¨æ ¼è¡Œæ•°æ®
        function collectTableRows(tableId) {
            const table = document.getElementById(tableId);
            if (!table) return [];
            
            const rows = [];
            const trElements = table.querySelectorAll('tbody tr');
            
            trElements.forEach((tr, index) => {
                const row = {};
                const inputs = tr.querySelectorAll('input, select');
                
                inputs.forEach(input => {
                    if (input.type === 'file') return; // è·³è¿‡æ–‡ä»¶è¾“å…¥
                    
                    const name = input.id;
                    if (name && !name.includes('remove')) {
                        if (input.tagName === 'SELECT') {
                            // ä¿å­˜ä¸‹æ‹‰èœå•çš„é€‰ä¸­å€¼å’Œæ˜¾ç¤ºæ–‡æœ¬
                            row[name] = {
                                value: input.value,
                                text: input.options[input.selectedIndex]?.text || ''
                            };
                        } else {
                            row[name] = input.value;
                        }
                    }
                });
                
                if (Object.keys(row).length > 0) {
                    rows.push(row);
                }
            });
            
            return rows;
        }
        
        // æ”¶é›†å›¾ç‰‡æ•°æ®
        function collectImagesData() {
            if (!document.getElementById('includeImages').checked) {
                return [];
            }
            
            const images = [];
            const imageItems = document.querySelectorAll('#anomaly-images .image-item img');
            
            imageItems.forEach((img, index) => {
                try {
                    const canvas = document.createElement('canvas');
                    const ctx = canvas.getContext('2d');
                    canvas.width = img.naturalWidth;
                    canvas.height = img.naturalHeight;
                    ctx.drawImage(img, 0, 0);
                    
                    const dataUrl = canvas.toDataURL('image/jpeg', 0.8);
                    images.push({
                        index: index,
                        dataUrl: dataUrl,
                        description: document.getElementById('imageDescription').value || `å›¾ç‰‡${index + 1}`
                    });
                } catch (e) {
                    console.error('æ— æ³•å¤„ç†å›¾ç‰‡:', e);
                }
            });
            
            return images;
        }
        
        // è·å–è¾“å…¥å€¼
        function getInputValue(input) {
            if (input.type === 'checkbox' || input.type === 'radio') {
                return input.checked;
            } else if (input.tagName === 'SELECT') {
                return {
                    value: input.value,
                    text: input.options[input.selectedIndex]?.text || ''
                };
            } else {
                return input.value;
            }
        }
        
        // ç”ŸæˆID
        function generateId() {
            return 'report_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9);
        }
        
        // ä¿å­˜åˆ°æœ¬åœ°å­˜å‚¨
        function saveToLocalStorage(reportData) {
            updateSaveProgress(50, 'ä¿å­˜åˆ°æœ¬åœ°å­˜å‚¨...');
            
            try {
                const reportName = document.getElementById('reportName').value || 'æœªå‘½åæŠ¥å‘Š';
                const reports = JSON.parse(localStorage.getItem('savedReports') || '[]');
                
                // æ£€æŸ¥æ˜¯å¦å·²å­˜åœ¨åŒåæŠ¥å‘Š
                const existingIndex = reports.findIndex(r => r.metadata.id === reportData.metadata.id);
                
                if (existingIndex >= 0) {
                    // æ›´æ–°ç°æœ‰æŠ¥å‘Š
                    reports[existingIndex] = reportData;
                } else {
                    // æ·»åŠ æ–°æŠ¥å‘Š
                    reports.push(reportData);
                }
                
                // ä¿å­˜åˆ°æœ¬åœ°å­˜å‚¨
                localStorage.setItem('savedReports', JSON.stringify(reports));
                
                // æ›´æ–°å½“å‰æŠ¥å‘ŠID
                currentReportId = reportData.metadata.id;
                
                updateSaveProgress(80, 'æ›´æ–°æœ¬åœ°ç¼“å­˜...');
                
                // ä¿å­˜åˆ°ä¼šè¯å­˜å‚¨ï¼ˆç”¨äºæ¢å¤ï¼‰
                saveToSession();
                
                // æ›´æ–°çŠ¶æ€
                hasUnsavedChanges = false;
                lastSaveTime = new Date().toISOString();
                
                updateSaveProgress(100, 'ä¿å­˜å®Œæˆï¼');
                
                // æ˜¾ç¤ºæˆåŠŸæ¶ˆæ¯
                showSaveSuccess(`æŠ¥å‘Š"${reportName}"å·²ä¿å­˜åˆ°æœ¬åœ°å­˜å‚¨`);
                
                // æ›´æ–°UI
                updateReportStatus();
                updateLastSavedTime();
                refreshReportList();
                
                // å…³é—­æ¨¡æ€æ¡†ï¼ˆå¦‚æœæ˜¯æ‰‹åŠ¨ä¿å­˜ï¼‰
                if (document.getElementById('saveModal').style.display === 'flex') {
                    setTimeout(() => {
                        closeSaveModal();
                    }, 1500);
                }
                
            } catch (e) {
                console.error('ä¿å­˜åˆ°æœ¬åœ°å­˜å‚¨å¤±è´¥:', e);
                showSaveError('ä¿å­˜å¤±è´¥ï¼š' + e.message);
            }
        }
        
        // ä¿å­˜åˆ°æ–‡ä»¶
        function saveToFile(reportData) {
            updateSaveProgress(50, 'ç”Ÿæˆæ–‡ä»¶...');
            
            try {
                // å‹ç¼©æ•°æ®ï¼ˆå¦‚æœéœ€è¦ï¼‰
                if (document.getElementById('compressData').checked) {
                    reportData = compressData(reportData);
                }
                
                const jsonStr = JSON.stringify(reportData, null, 2);
                const fileName = document.getElementById('fileName').value || 'report.json';
                
                const blob = new Blob([jsonStr], { type: 'application/json' });
                
                updateSaveProgress(80, 'å‡†å¤‡ä¸‹è½½...');
                
                // ä½¿ç”¨FileSaver.jsä¿å­˜æ–‡ä»¶
                saveAs(blob, fileName);
                
                updateSaveProgress(100, 'æ–‡ä»¶å·²ç”Ÿæˆï¼');
                
                // æ˜¾ç¤ºæˆåŠŸæ¶ˆæ¯
                showSaveSuccess(`æŠ¥å‘Šå·²å¯¼å‡ºä¸ºæ–‡ä»¶: ${fileName}`);
                
                // ä¹Ÿä¿å­˜åˆ°æœ¬åœ°å­˜å‚¨ä½œä¸ºå¤‡ä»½
                if (document.getElementById('createBackup').checked) {
                    setTimeout(() => {
                        saveToLocalStorage(reportData);
                    }, 1000);
                }
                
            } catch (e) {
                console.error('ä¿å­˜åˆ°æ–‡ä»¶å¤±è´¥:', e);
                showSaveError('ä¿å­˜å¤±è´¥ï¼š' + e.message);
            }
        }
        
        // ä¿å­˜åˆ°äº‘ç«¯ï¼ˆæ¨¡æ‹Ÿï¼‰
        function saveToCloud(reportData) {
            updateSaveProgress(50, 'è¿æ¥æœåŠ¡å™¨...');
            
            const serverUrl = document.getElementById('serverUrl').value;
            if (!serverUrl) {
                showSaveError('è¯·å…ˆé…ç½®æœåŠ¡å™¨åœ°å€');
                return;
            }
            
            // åŠ å¯†æ•°æ®ï¼ˆå¦‚æœéœ€è¦ï¼‰
            if (document.getElementById('encryptData').checked) {
                reportData = encryptData(reportData);
            }
            
            // æ¨¡æ‹ŸAPIè°ƒç”¨
            setTimeout(() => {
                updateSaveProgress(80, 'ä¸Šä¼ æ•°æ®...');
                
                // è¿™é‡Œåº”è¯¥æ˜¯å®é™…çš„APIè°ƒç”¨
                // fetch(serverUrl, {
                //     method: 'POST',
                //     headers: { 'Content-Type': 'application/json' },
                //     body: JSON.stringify(reportData)
                // })
                // .then(response => response.json())
                // .then(data => {
                //     updateSaveProgress(100, 'ä¸Šä¼ å®Œæˆï¼');
                //     showSaveSuccess('æŠ¥å‘Šå·²ä¿å­˜åˆ°äº‘ç«¯');
                // })
                // .catch(error => {
                //     showSaveError('ä¸Šä¼ å¤±è´¥ï¼š' + error.message);
                // });
                
                // æ¨¡æ‹ŸæˆåŠŸ
                updateSaveProgress(100, 'ä¸Šä¼ å®Œæˆï¼');
                showSaveSuccess('æŠ¥å‘Šå·²ä¿å­˜åˆ°äº‘ç«¯ï¼ˆæ¨¡æ‹Ÿï¼‰');
                
            }, 2000);
        }
        
        // è‡ªåŠ¨ä¿å­˜
        function autoSave() {
            if (!hasUnsavedChanges) return;
            
            document.getElementById('autoSaveIndicator').style.display = 'block';
            
            setTimeout(() => {
                saveToSession();
                showSaveIndicator('è‡ªåŠ¨ä¿å­˜å®Œæˆ', 'info');
                document.getElementById('autoSaveIndicator').style.display = 'none';
            }, 1000);
        }
        
        // ä¿å­˜åˆ°ä¼šè¯å­˜å‚¨
        function saveToSession() {
            const sessionData = collectReportData();
            localStorage.setItem('lastReportSession', JSON.stringify(sessionData));
            lastSaveTime = new Date().toISOString();
            updateLastSavedTime();
        }
        
        // å‹ç¼©æ•°æ®
        function compressData(data) {
            // ç®€å•çš„æ•°æ®å‹ç¼©ï¼šç§»é™¤ç©ºå€¼å’Œé•¿å­—ç¬¦ä¸²çš„ç©ºç™½
            return JSON.parse(JSON.stringify(data, (key, value) => {
                if (value === null || value === undefined || value === '') {
                    return undefined;
                }
                if (typeof value === 'string') {
                    return value.trim();
                }
                return value;
            }));
        }
        
        // åŠ å¯†æ•°æ®ï¼ˆæ¨¡æ‹Ÿï¼‰
        function encryptData(data) {
            // è¿™é‡Œåº”è¯¥ä½¿ç”¨å®é™…çš„åŠ å¯†ç®—æ³•
            // æ¨¡æ‹Ÿï¼šç®€å•base64ç¼–ç 
            return {
                encrypted: true,
                data: btoa(JSON.stringify(data))
            };
        }
        
        // æ›´æ–°ä¿å­˜è¿›åº¦
        function updateSaveProgress(percent, message) {
            document.getElementById('saveProgressFill').style.width = percent + '%';
            document.getElementById('saveProgressText').textContent = message;
        }
        
        // é‡ç½®ä¿å­˜UI
        function resetSaveUI() {
            document.getElementById('saveProgressBar').style.display = 'none';
            document.getElementById('saveProgressText').style.display = 'none';
            document.getElementById('saveProgressFill').style.width = '0%';
            document.getElementById('saveStatus').style.display = 'none';
            document.getElementById('saveStatus').className = 'save-status';
            document.getElementById('saveStatus').innerHTML = '';
        }
        
        // æ˜¾ç¤ºä¿å­˜æˆåŠŸæ¶ˆæ¯
        function showSaveSuccess(message) {
            const statusDiv = document.getElementById('saveStatus');
            statusDiv.className = 'save-status save-success';
            statusDiv.innerHTML = `
                <strong>âœ“ ä¿å­˜æˆåŠŸï¼</strong><br>
                ${message}
            `;
            statusDiv.style.display = 'block';
        }
        
        // æ˜¾ç¤ºä¿å­˜é”™è¯¯æ¶ˆæ¯
        function showSaveError(message) {
            const statusDiv = document.getElementById('saveStatus');
            statusDiv.className = 'save-status save-error';
            statusDiv.innerHTML = `
                <strong>âœ— ä¿å­˜å¤±è´¥ï¼</strong><br>
                ${message}
            `;
            statusDiv.style.display = 'block';
        }
        
        // æ˜¾ç¤ºä¿å­˜æç¤º
        function showSaveIndicator(message, type = 'success') {
            const indicator = document.getElementById('saveIndicator');
            indicator.textContent = message;
            indicator.className = `save-indicator ${type === 'error' ? 'save-error' : type === 'warning' ? 'save-warning' : ''}`;
            indicator.style.display = 'flex';
            
            setTimeout(() => {
                indicator.style.display = 'none';
            }, 3000);
        }
        
        // ==================== åŠ è½½åŠŸèƒ½ ====================
        
        // æ‰“å¼€åŠ è½½æ¨¡æ€æ¡†
        function openLoadModal() {
            document.getElementById('loadModal').style.display = 'flex';
            refreshReportList();
        }
        
        // å…³é—­åŠ è½½æ¨¡æ€æ¡†
        function closeLoadModal() {
            document.getElementById('loadModal').style.display = 'none';
        }
        
        // æ”¹å˜åŠ è½½æ¥æº
        function changeLoadSource(source) {
            document.getElementById('localReports').style.display = 'none';
            document.getElementById('fileImport').style.display = 'none';
            document.getElementById('cloudLoad').style.display = 'none';
            document.getElementById(source === 'local' ? 'localReports' : source === 'file' ? 'fileImport' : 'cloudLoad').style.display = 'block';
        }
        
        // åˆ·æ–°æŠ¥å‘Šåˆ—è¡¨
        function refreshReportList() {
            const reportsList = document.getElementById('savedReportsList');
            const reports = JSON.parse(localStorage.getItem('savedReports') || '[]');
            
            if (reports.length === 0) {
                reportsList.innerHTML = '<div class="empty-list">æš‚æ— ä¿å­˜çš„æŠ¥å‘Š</div>';
                return;
            }
            
            reportsList.innerHTML = '';
            
            reports.forEach((report, index) => {
                const metadata = report.metadata;
                const item = document.createElement('div');
                item.className = 'report-item';
                item.dataset.index = index;
                item.onclick = function() {
                    selectReport(this, report);
                };
                
                item.innerHTML = `
                    <div class="report-title">${metadata.name || 'æœªå‘½åæŠ¥å‘Š'}</div>
                    <div class="report-meta">
                        <span>ç¼–å·: ${metadata.number || 'æ— '}</span>
                        <span>${new Date(metadata.updatedAt).toLocaleString()}</span>
                    </div>
                    <div class="report-actions">
                        <button onclick="loadSelectedReport(event, ${index})" style="font-size: 9pt; padding: 0.2cm;">åŠ è½½</button>
                        <button onclick="deleteReport(event, ${index})" style="font-size: 9pt; padding: 0.2cm; background: #f8d7da; border-color: #dc3545; color: #dc3545;">åˆ é™¤</button>
                    </div>
                `;
                
                reportsList.appendChild(item);
            });
        }
        
        // é€‰æ‹©æŠ¥å‘Š
        function selectReport(element, report) {
            document.querySelectorAll('.report-item').forEach(el => {
                el.classList.remove('selected');
            });
            element.classList.add('selected');
        }
        
        // åŠ è½½é€‰ä¸­çš„æŠ¥å‘Š
        function loadSelectedReport(event, index) {
            event.stopPropagation();
            
            const reports = JSON.parse(localStorage.getItem('savedReports') || '[]');
            if (reports[index]) {
                loadReportData(reports[index]);
                closeLoadModal();
                showSaveIndicator('æŠ¥å‘ŠåŠ è½½æˆåŠŸ', 'success');
            }
        }
        
        // åˆ é™¤æŠ¥å‘Š
        function deleteReport(event, index) {
            event.stopPropagation();
            
            if (confirm('ç¡®å®šè¦åˆ é™¤è¿™ä¸ªæŠ¥å‘Šå—ï¼Ÿ')) {
                const reports = JSON.parse(localStorage.getItem('savedReports') || '[]');
                reports.splice(index, 1);
                localStorage.setItem('savedReports', JSON.stringify(reports));
                refreshReportList();
                showSaveIndicator('æŠ¥å‘Šå·²åˆ é™¤', 'warning');
            }
        }
        
        // æ¸…ç©ºæ‰€æœ‰æŠ¥å‘Š
        function clearAllReports() {
            if (confirm('ç¡®å®šè¦æ¸…ç©ºæ‰€æœ‰ä¿å­˜çš„æŠ¥å‘Šå—ï¼Ÿæ­¤æ“ä½œä¸å¯æ’¤é”€ã€‚')) {
                localStorage.removeItem('savedReports');
                refreshReportList();
                showSaveIndicator('æ‰€æœ‰æŠ¥å‘Šå·²æ¸…ç©º', 'warning');
            }
        }
        
        // ä»æ–‡ä»¶åŠ è½½
        function loadFromFile() {
            const fileInput = document.getElementById('reportFile');
            const file = fileInput.files[0];
            
            if (!file) {
                showLoadError('è¯·å…ˆé€‰æ‹©æ–‡ä»¶');
                return;
            }
            
            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const reportData = JSON.parse(e.target.result);
                    loadReportData(reportData);
                    closeLoadModal();
                    showSaveIndicator('æ–‡ä»¶å¯¼å…¥æˆåŠŸ', 'success');
                } catch (error) {
                    showLoadError('æ–‡ä»¶æ ¼å¼é”™è¯¯ï¼š' + error.message);
                }
            };
            reader.onerror = function() {
                showLoadError('è¯»å–æ–‡ä»¶å¤±è´¥');
            };
            reader.readAsText(file);
        }
        
        // ä»äº‘ç«¯åŠ è½½ï¼ˆæ¨¡æ‹Ÿï¼‰
        function loadFromCloud() {
            const serverUrl = document.getElementById('cloudServerUrl').value;
            const reportId = document.getElementById('cloudReportId').value;
            
            if (!serverUrl || !reportId) {
                showLoadError('è¯·å¡«å†™æœåŠ¡å™¨åœ°å€å’ŒæŠ¥å‘ŠID');
                return;
            }
            
            // æ¨¡æ‹ŸAPIè°ƒç”¨
            setTimeout(() => {
                // è¿™é‡Œåº”è¯¥æ˜¯å®é™…çš„APIè°ƒç”¨
                // fetch(`${serverUrl}?id=${reportId}`)
                // .then(response => response.json())
                // .then(data => {
                //     loadReportData(data);
                //     closeLoadModal();
                //     showSaveIndicator('äº‘ç«¯åŠ è½½æˆåŠŸ', 'success');
                // })
                // .catch(error => {
                //     showLoadError('åŠ è½½å¤±è´¥ï¼š' + error.message);
                // });
                
                showLoadError('äº‘ç«¯åŠ è½½åŠŸèƒ½éœ€è¦é…ç½®å®é™…APIæ¥å£');
            }, 1000);
        }
        
        // åŠ è½½æŠ¥å‘Šæ•°æ®åˆ°è¡¨å•
        function loadReportData(reportData) {
            // é˜»æ­¢è‡ªåŠ¨ä¿å­˜è§¦å‘
            hasUnsavedChanges = false;
            
            // åŠ è½½å…ƒæ•°æ®
            const metadata = reportData.metadata;
            currentReportId = metadata.id;
            
            if (metadata.number) document.getElementById('reportNumber').value = metadata.number;
            if (metadata.date) document.getElementById('reportDate').value = metadata.date;
            if (metadata.state) document.getElementById('reportState').value = metadata.state;
            
            // åŠ è½½åŸºæœ¬ä¿¡æ¯
            loadSectionData(reportData.basicInfo, 'basic');
            
            // åŠ è½½å¼‚å¸¸æè¿°
            loadSectionData(reportData.description, 'description');
            
            // åŠ è½½å½±å“è¯„ä¼°
            loadSectionData(reportData.impact, 'impact');
            
            // åŠ è½½å¼‚å¸¸å¤„ç†
            loadSectionData(reportData.treatment, 'treatment');
            
            // åŠ è½½æ ¹å› åˆ†æ
            loadSectionData(reportData.rootCause, 'rootCause');
            
            // åŠ è½½æ”¹å–„æªæ–½
            loadSectionData(reportData.improvement, 'improvement');
            
            // åŠ è½½æ•ˆæœéªŒè¯
            loadSectionData(reportData.validation, 'validation');
            
            // åŠ è½½é¢„é˜²æœºåˆ¶
            loadSectionData(reportData.prevention, 'prevention');
            
            // åŠ è½½å®¡æ‰¹ä¿¡æ¯
            loadSectionData(reportData.approval, 'approval');
            
            // åŠ è½½å½’æ¡£ä¿¡æ¯
            loadSectionData(reportData.archive, 'archive');
            
            // åŠ è½½è¡¨æ ¼æ•°æ® - å…³é”®ä¿®å¤éƒ¨åˆ†
            if (reportData.tables) {
                loadTableData(reportData.tables);
            }
            
            // åŠ è½½å›¾ç‰‡æ•°æ®
            if (reportData.images) {
                loadImagesData(reportData.images);
            }
            
            // æ›´æ–°çŠ¶æ€
            hasUnsavedChanges = false;
            updateReportStatus();
            
            // æ›´æ–°ä¿å­˜æ—¶é—´
            if (metadata.updatedAt) {
                lastSaveTime = metadata.updatedAt;
                updateLastSavedTime();
            }
        }
        
        // åŠ è½½è¡¨æ ¼æ•°æ® - å®Œæ•´å®ç°
        function loadTableData(tables) {
            if (!tables) return;
            
            // 1. å¤„ç†å¼‚å¸¸å¤„ç†è¡¨æ ¼
            if (tables.treatment && tables.treatment.length > 0) {
                loadTreatmentTable(tables.treatment);
            }
            
            // 2. å¤„ç†ä¸´æ—¶çº æ­£æªæ–½è¡¨æ ¼
            if (tables.temporaryMeasures && tables.temporaryMeasures.length > 0) {
                loadMeasureTable('temporary-measures-table', tables.temporaryMeasures, 'temp');
            }
            
            // 3. å¤„ç†é•¿æœŸé¢„é˜²æªæ–½è¡¨æ ¼
            if (tables.longTermMeasures && tables.longTermMeasures.length > 0) {
                loadMeasureTable('long-term-measures-table', tables.longTermMeasures, 'long');
            }
            
            // 4. å¤„ç†èµ„æºéœ€æ±‚è¡¨æ ¼
            if (tables.resources && tables.resources.length > 0) {
                loadResourceTable(tables.resources);
            }
            
            // 5. å¤„ç†é£é™©é¢„åˆ¤è¡¨æ ¼
            if (tables.risks && tables.risks.length > 0) {
                loadRiskTable(tables.risks);
            }
            
            // 6. å¤„ç†é™„ä»¶æ¸…å•è¡¨æ ¼
            if (tables.attachments && tables.attachments.length > 0) {
                loadAttachmentTable(tables.attachments);
            }
            
            // 7. å¤„ç†å®¡æ‰¹æµç¨‹è¡¨æ ¼
            if (tables.approval && tables.approval.length > 0) {
                loadApprovalTable(tables.approval);
            }
            
            // 8. å¤„ç†ç‰ˆæœ¬è®°å½•è¡¨æ ¼
            if (tables.versions && tables.versions.length > 0) {
                loadVersionTable(tables.versions);
            }
        }
        
        // åŠ è½½ç« èŠ‚æ•°æ®
        function loadSectionData(data, section) {
            if (!data) return;
            
            for (const [key, value] of Object.entries(data)) {
                const element = document.getElementById(key);
                if (element) {
                    if (element.tagName === 'SELECT' && value && typeof value === 'object') {
                        element.value = value.value;
                    } else {
                        element.value = value;
                    }
                }
            }
        }
        
        // åŠ è½½å›¾ç‰‡æ•°æ®
        function loadImagesData(images) {
            const imageGrid = document.getElementById('anomaly-images');
            imageGrid.innerHTML = '';
            
            images.forEach(image => {
                const imageItem = document.createElement('div');
                imageItem.className = 'image-item';
                
                const img = document.createElement('img');
                img.src = image.dataUrl;
                img.alt = image.description;
                
                const removeBtn = document.createElement('button');
                removeBtn.className = 'image-remove';
                removeBtn.innerHTML = 'X';
                removeBtn.onclick = function() {
                    imageGrid.removeChild(imageItem);
                    markAsChanged();
                };
                
                imageItem.appendChild(img);
                imageItem.appendChild(removeBtn);
                imageGrid.appendChild(imageItem);
            });
        }
        
        // æ˜¾ç¤ºåŠ è½½é”™è¯¯
        function showLoadError(message) {
            const statusDiv = document.getElementById('loadStatus');
            statusDiv.className = 'save-status save-error';
            statusDiv.innerHTML = `
                <strong>âœ— åŠ è½½å¤±è´¥ï¼</strong><br>
                ${message}
            `;
            statusDiv.style.display = 'block';
        }
        
        // ==================== è¡¨æ ¼æ“ä½œå‡½æ•° ====================
        
        // æ·»åŠ å¼‚å¸¸å¤„ç†è¡Œ
        function addTreatmentRow() {
            const table = document.getElementById('treatment-table');
            const tbody = table.querySelector('tbody');
            const rowCount = tbody.querySelectorAll('tr').length;
            
            const newRow = document.createElement('tr');
            newRow.innerHTML = `
                <td><input type="text" placeholder="å…·ä½“å¤„ç†æ–¹æ³•" style="width: 100%; border: none;" id="treatmentMethod_${rowCount}"></td>
                <td>
                    <select style="width: 100%; border: none;" id="treatmentPriority_${rowCount}">
                        <option value="">è¯·é€‰æ‹©</option>
                        <option value="high" class="priority-high">é«˜</option>
                        <option value="medium" class="priority-medium">ä¸­</option>
                        <option value="low" class="priority-low">ä½</option>
                    </select>
                </td>
                <td><input type="datetime-local" style="width: 100%; border: none;" id="treatmentCompleteTime_${rowCount}"></td>
                <td><input type="text" placeholder="å¤„ç†ç»“æœ" style="width: 100%; border: none;" id="treatmentResult_${rowCount}"></td>
                <td><input type="text" placeholder="ç¡®è®¤äºº" style="width: 100%; border: none;" id="treatmentConfirmer_${rowCount}"></td>
                <td><button class="remove-row-btn" onclick="removeRow(this)">X</button></td>
            `;
            
            tbody.appendChild(newRow);
            markAsChanged();
        }
        
        // æ·»åŠ æ”¹å–„æªæ–½è¡Œ
        function addRow(tableId) {
            const table = document.getElementById(tableId);
            const tbody = table.querySelector('tbody');
            const rowCount = tbody.querySelectorAll('tr').length;
            
            let newRow;
            
            if (tableId === 'temporary-measures-table') {
                newRow = document.createElement('tr');
                newRow.innerHTML = `
                    <td><input type="text" placeholder="æªæ–½å†…å®¹" style="width: 100%; border: none;" id="tempMeasureContent_${rowCount}"></td>
                    <td><input type="text" placeholder="è´£ä»»äºº" style="width: 100%; border: none;" id="tempMeasurePerson_${rowCount}"></td>
                    <td><input type="date" style="width: 100%; border: none;" id="tempMeasureDeadline_${rowCount}"></td>
                    <td><input type="text" placeholder="éªŒæ”¶æ ‡å‡†" style="width: 100%; border: none;" id="tempMeasureStandard_${rowCount}"></td>
                    <td>
                        <select style="width: 100%; border: none;" id="tempMeasurePriority_${rowCount}">
                            <option value="">è¯·é€‰æ‹©</option>
                            <option value="high" class="priority-high">é«˜</option>
                            <option value="medium" class="priority-medium">ä¸­</option>
                            <option value="low" class="priority-low">ä½</option>
                        </select>
                    </td>
                    <td><button class="remove-row-btn" onclick="removeRow(this)">X</button></td>
                `;
            } else if (tableId === 'long-term-measures-table') {
                newRow = document.createElement('tr');
                newRow.innerHTML = `
                    <td><input type="text" placeholder="æªæ–½å†…å®¹" style="width: 100%; border: none;" id="longMeasureContent_${rowCount}"></td>
                    <td><input type="text" placeholder="è´£ä»»äºº" style="width: 100%; border: none;" id="longMeasurePerson_${rowCount}"></td>
                    <td><input type="date" style="width: 100%; border: none;" id="longMeasureDeadline_${rowCount}"></td>
                    <td><input type="text" placeholder="éªŒæ”¶æ ‡å‡†" style="width: 100%; border: none;" id="longMeasureStandard_${rowCount}"></td>
                    <td>
                        <select style="width: 100%; border: none;" id="longMeasurePriority_${rowCount}">
                            <option value="">è¯·é€‰æ‹©</option>
                            <option value="high" class="priority-high">é«˜</option>
                            <option value="medium" class="priority-medium">ä¸­</option>
                            <option value="low" class="priority-low">ä½</option>
                        </select>
                    </td>
                    <td><button class="remove-row-btn" onclick="removeRow(this)">X</button></td>
                `;
            }
            
            tbody.appendChild(newRow);
            markAsChanged();
        }
        
        // æ·»åŠ èµ„æºéœ€æ±‚è¡Œ
        function addResourceRow() {
            const table = document.getElementById('resource-table');
            const tbody = table.querySelector('tbody');
            const rowCount = tbody.querySelectorAll('tr').length;
            
            const newRow = document.createElement('tr');
            newRow.innerHTML = `
                <td>
                    <select style="width: 100%; border: none;" id="resourceType_${rowCount}">
                        <option value="">è¯·é€‰æ‹©</option>
                        <option value="human">äººåŠ›</option>
                        <option value="material">ç‰©åŠ›</option>
                        <option value="technical">æŠ€æœ¯</option>
                        <option value="financial">èµ„é‡‘</option>
                    </select>
                </td>
                <td><input type="text" placeholder="éœ€æ±‚æè¿°" style="width: 100%; border: none;" id="resourceDescription_${rowCount}"></td>
                <td>
                    <select style="width: 100%; border: none;" id="resourcePriority_${rowCount}">
                        <option value="">è¯·é€‰æ‹©</option>
                        <option value="high" class="priority-high">é«˜</option>
                        <option value="medium" class="priority-medium">ä¸­</option>
                        <option value="low" class="priority-low">ä½</option>
                    </select>
                </td>
                <td><input type="date" style="width: 100%; border: none;" id="resourceDeadline_${rowCount}"></td>
                <td><input type="text" placeholder="èµ„æºæä¾›éƒ¨é—¨" style="width: 100%; border: none;" id="resourceDepartment_${rowCount}"></td>
                <td><button class="remove-row-btn" onclick="removeRow(this)">X</button></td>
            `;
            
            tbody.appendChild(newRow);
            markAsChanged();
        }
        
        // æ·»åŠ é£é™©é¢„åˆ¤è¡Œ
        function addRiskRow() {
            const table = document.getElementById('risk-table');
            const tbody = table.querySelector('tbody');
            const rowCount = tbody.querySelectorAll('tr').length;
            
            const newRow = document.createElement('tr');
            newRow.innerHTML = `
                <td><input type="text" placeholder="æ½œåœ¨é£é™©" style="width: 100%; border: none;" id="riskPotential_${rowCount}"></td>
                <td>
                    <select style="width: 100%; border: none;" id="riskLevel_${rowCount}">
                        <option value="">è¯·é€‰æ‹©</option>
                        <option value="high" class="priority-high">é«˜</option>
                        <option value="medium" class="priority-medium">ä¸­</option>
                        <option value="low" class="priority-low">ä½</option>
                    </select>
                </td>
                <td><input type="text" placeholder="åº”å¯¹é¢„æ¡ˆ" style="width: 100%; border: none;" id="riskResponse_${rowCount}"></td>
                <td><input type="text" placeholder="è´£ä»»äºº" style="width: 100%; border: none;" id="riskPerson_${rowCount}"></td>
                <td><button class="remove-row-btn" onclick="removeRow(this)">X</button></td>
            `;
            
            tbody.appendChild(newRow);
            markAsChanged();
        }
        
        // æ·»åŠ é™„ä»¶è¡Œ
        function addAttachmentRow() {
            const table = document.getElementById('attachment-table');
            const tbody = table.querySelector('tbody');
            const rowCount = tbody.querySelectorAll('tr').length;
            
            const newRow = document.createElement('tr');
            newRow.innerHTML = `
                <td><input type="text" placeholder="é™„ä»¶åç§°" style="width: 100%; border: none;" id="attachmentName_${rowCount}"></td>
                <td><input type="text" placeholder="é™„ä»¶ç‰ˆæœ¬" style="width: 100%; border: none;" id="attachmentVersion_${rowCount}"></td>
                <td><input type="text" placeholder="ä¸Šä¼ è·¯å¾„/å­˜å‚¨ä½ç½®" style="width: 100%; border: none;" id="attachmentPath_${rowCount}"></td>
                <td><input type="text" placeholder="å­˜å‚¨æœŸé™" style="width: 100%; border: none;" id="attachmentStoragePeriod_${rowCount}"></td>
                <td><input type="text" placeholder="å¤‡æ³¨" style="width: 100%; border: none;" id="attachmentRemark_${rowCount}"></td>
            `;
            
            tbody.appendChild(newRow);
            markAsChanged();
        }
        
        // æ·»åŠ ç‰ˆæœ¬è®°å½•è¡Œ
        function addVersionRow() {
            const table = document.getElementById('version-table');
            const tbody = table.querySelector('tbody');
            const rowCount = tbody.querySelectorAll('tr').length;
            
            const newRow = document.createElement('tr');
            newRow.innerHTML = `
                <td><input type="text" placeholder="ç‰ˆæœ¬å·" style="width: 100%; border: none;" id="versionNumber_${rowCount}"></td>
                <td><input type="date" style="width: 100%; border: none;" id="versionDate_${rowCount}"></td>
                <td><input type="text" placeholder="æ›´æ–°å†…å®¹" style="width: 100%; border: none;" id="versionContent_${rowCount}"></td>
                <td><input type="text" placeholder="æ›´æ–°äºº" style="width: 100%; border: none;" id="versionUpdater_${rowCount}"></td>
                <td><input type="text" placeholder="å®¡æ ¸äºº" style="width: 100%; border: none;" id="versionApprover_${rowCount}"></td>
            `;
            
            tbody.appendChild(newRow);
            markAsChanged();
        }
        
        // åˆ é™¤è¡Œ
        function removeRow(button) {
            const row = button.parentNode.parentNode;
            const tbody = row.parentNode;
            
            // ç¡®ä¿è‡³å°‘ä¿ç•™ä¸€è¡Œ
            if (tbody.querySelectorAll('tr').length > 1) {
                tbody.removeChild(row);
                markAsChanged();
            } else {
                alert('è‡³å°‘éœ€è¦ä¿ç•™ä¸€è¡Œæ•°æ®');
            }
        }
        
        // ==================== å…¶ä»–åŠŸèƒ½ ====================
        
        // é‡ç½®è¡¨å•
        function resetForm() {
            if (hasUnsavedChanges && !confirm('æ‚¨æœ‰æœªä¿å­˜çš„æ›´æ”¹ï¼Œç¡®å®šè¦é‡ç½®å—ï¼Ÿ')) {
                return;
            }
            
            if (confirm('ç¡®å®šè¦é‡ç½®æ‰€æœ‰å†…å®¹å—ï¼Ÿ')) {
                document.querySelectorAll('input, textarea, select').forEach(element => {
                    if (element.type !== 'file') {
                        element.value = '';
                    }
                });
                
                // æ¸…ç©ºå›¾ç‰‡
                document.getElementById('anomaly-images').innerHTML = '';
                
                // ç”Ÿæˆæ–°çš„æŠ¥å‘Šç¼–å·
                generateReportNumber();
                
                // é‡ç½®çŠ¶æ€
                currentReportId = null;
                hasUnsavedChanges = false;
                updateReportStatus();
                
                showSaveIndicator('è¡¨å•å·²é‡ç½®', 'warning');
            }
        }
        
        // å¯¼å‡ºPDFï¼ˆæ¨¡æ‹Ÿï¼‰
        function saveAsPDF() {
            alert('PDFå¯¼å‡ºåŠŸèƒ½éœ€è¦é›†æˆPDFç”Ÿæˆåº“');
        }
        
        // Excelå¯¼å‡ºåŠŸèƒ½
        function openExcelExportModal() {
            alert('Excelå¯¼å‡ºåŠŸèƒ½éœ€è¦é¢å¤–çš„å®ç°');
        }
        
        // å›¾ç‰‡ä¸Šä¼ åŠŸèƒ½
        document.getElementById('anomaly-image-upload').addEventListener('change', function(e) {
            const files = e.target.files;
            const imageGrid = document.getElementById('anomaly-images');
            
            // é™åˆ¶æœ€å¤š5å¼ å›¾ç‰‡
            if (imageGrid.children.length + files.length > 5) {
                alert('æœ€å¤šåªèƒ½ä¸Šä¼ 5å¼ å›¾ç‰‡');
                return;
            }
            
            for (let i = 0; i < files.length; i++) {
                const file = files[i];
                if (file) {
                    const reader = new FileReader();
                    reader.onload = function(e) {
                        const imageItem = document.createElement('div');
                        imageItem.className = 'image-item';
                        
                        const img = document.createElement('img');
                        img.src = e.target.result;
                        img.alt = "å¼‚å¸¸å›¾ç‰‡";
                        
                        const removeBtn = document.createElement('button');
                        removeBtn.className = 'image-remove';
                        removeBtn.innerHTML = 'X';
                        removeBtn.onclick = function() {
                            imageGrid.removeChild(imageItem);
                            markAsChanged();
                        };
                        
                        imageItem.appendChild(img);
                        imageItem.appendChild(removeBtn);
                        imageGrid.appendChild(imageItem);
                        
                        markAsChanged();
                    };
                    reader.readAsDataURL(file);
                }
            }
            
            e.target.value = '';
        });
        
        // é±¼éª¨å›¾ä¸Šä¼ åŠŸèƒ½
        document.getElementById('fishbone-upload').addEventListener('change', function(e) {
            const file = e.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    const placeholder = document.getElementById('fishbone-placeholder');
                    placeholder.innerHTML = `<img src="${e.target.result}" style="max-width: 100%; max-height: 100%;" alt="é±¼éª¨å›¾">`;
                    markAsChanged();
                };
                reader.readAsDataURL(file);
            }
        });
        
        // æ”¹å–„æªæ–½ä¸Šä¼ åŠŸèƒ½
        document.getElementById('improvement-upload').addEventListener('change', function(e) {
            const file = e.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    const placeholder = document.getElementById('improvement-placeholder');
                    placeholder.innerHTML = `<img src="${e.target.result}" style="max-width: 100%; max-height: 100%;" alt="æ”¹å–„æªæ–½">`;
                    markAsChanged();
                };
                reader.readAsDataURL(file);
            }
        });
    </script>
</body>
</html>
